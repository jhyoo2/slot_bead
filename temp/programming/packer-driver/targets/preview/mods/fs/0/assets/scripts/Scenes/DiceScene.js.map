{"version":3,"sources":["file:///Users/david/Desktop/David/cocos/slot_temp1/assets/scripts/Scenes/DiceScene.ts"],"names":["_decorator","size","director","Vec3","Node","instantiate","Sprite","tween","Label","Color","BaseScene","AssetManager","DiceManager","TileRail","ccclass","property","DiceScene","onLoad","assetManager","getInstance","loadAssets","assetResult","initDiceScene","diceManager","slotObject","initDiceManager","startIdx","basePos","blockSize","radius","iconNum","iconSize","eventTarget","blockLayer","insertChild","initBg","initTile","setLayer","bgLayer","setPosition","getLayerPos","tileLayer","objectLayer","moveLayer","time","playerIdx","getPlayerIdx","layerPos","to","position","start","railNum","Math","floor","rowNum","winSize","height","bgSpriteFrame","assetDic","i","j","bgNode","bgSprite","addComponent","spriteFrame","addChild","bgArray","push","moveBg","yPos","minPos","getPosition","y","len","length","lastObj","lastPos","x","z","beginNode","removeFromParent","destroy","splice","by","tilePrefab","prefabDic","tileNode","objectArray","getComponent","setTileObj","tileIdx","tileArray","moveTile","lastTile","firstTile","firstObj","t","objNode","update","dt","bgTime","buttonClicked","node","idx","rolling","rollWithNetwork","showDiceResult","diceResult","labelNode","label","color","fontSize","lineHeight","string","first","second","scale","call","showDiceEvent","delay","diceNum","self","eventTween","eventTime","moveStart","nextBlock","getNextBlock","yDiff","moveBlock","gotoMain","loadScene"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  size,\n  director,\n  Vec3,\n  Node,\n  instantiate,\n  Sprite,\n  Tween,\n  tween,\n  Label,\n  Color,\n} from \"cc\";\nconst { ccclass, property } = _decorator;\n\nimport BaseScene from \"../BaseObject/BaseScene\";\nimport AssetManager from \"../DataManager/AssetManager\";\nimport DiceManager from \"../Prefabs/DiceManager\";\nimport TileRail from \"../Prefabs/DiceScene/TileRail\";\n\n@ccclass(\"DiceScene\")\nexport class DiceScene extends BaseScene {\n  assetManager: AssetManager = null;\n  diceManager: DiceManager = null;\n\n  @property(Node)\n  mainCamera: Node | null = null;\n\n  @property(Node)\n  bgLayer: Node | null = null;\n  bgArray: Node[] = [];\n  bgTime = 0.0;\n\n  @property(Node)\n  tileLayer: Node | null = null;\n  tileArray: Node[] = [];\n  tileIdx = 0;\n\n  @property(Node)\n  objectLayer: Node | null = null;\n  objectArray: Node[] = [];\n\n  @property(Node)\n  blockLayer: Node | null = null;\n  basePos = new Vec3(0, 500, 0);\n  blockSize = new Vec3((1080 - 420) / 4, 773 / 8, 0);\n  startIdx = 4;\n\n  async onLoad() {\n    super.onLoad();\n    this.assetManager = AssetManager.getInstance();\n    const assetResult = await this.assetManager.loadAssets();\n    // console.log(this.assetManager);\n    this.initDiceScene();\n    const diceManager = new DiceManager();\n    const slotObject = diceManager.initDiceManager({\n      startIdx: this.startIdx,\n      basePos: this.basePos,\n      blockSize: this.blockSize,\n      radius: 450,\n      iconNum: 13,\n      iconSize: size(175, 175),\n    });\n    diceManager.eventTarget = this;\n    this.diceManager = diceManager;\n    this.blockLayer.insertChild(slotObject, 10);\n  }\n  initDiceScene() {\n    this.initBg();\n    this.initTile();\n    this.setLayer();\n  }\n  setLayer() {\n    this.bgLayer.setPosition(this.getLayerPos(this.startIdx));\n    this.tileLayer.setPosition(this.getLayerPos(this.startIdx));\n    this.blockLayer.setPosition(this.getLayerPos(this.startIdx));\n    this.objectLayer.setPosition(this.getLayerPos(this.startIdx));\n  }\n  moveLayer(time) {\n    const playerIdx = this.diceManager.getPlayerIdx() + 1;\n    const layerPos = this.getLayerPos(playerIdx);\n    tween(this.bgLayer).to(time, { position: layerPos }).start();\n    tween(this.tileLayer).to(time, { position: layerPos }).start();\n    tween(this.blockLayer).to(time, { position: layerPos }).start();\n    tween(this.objectLayer).to(time, { position: layerPos }).start();\n  }\n  getLayerPos(playerIdx) {\n    const railNum = Math.floor(playerIdx / 4);\n    if (railNum % 2 == 0) {\n      const rowNum = playerIdx % 4;\n      return new Vec3(100 - 50 * rowNum, -this.winSize.height / 2, 0);\n    } else {\n      const rowNum = playerIdx % 4;\n      return new Vec3(-100 + 50 * rowNum, -this.winSize.height / 2, 0);\n    }\n  }\n  initBg() {\n    const bgSpriteFrame = this.assetManager.assetDic[\"DiceScene/bg\"];\n    for (var i = 0; i < 6; i++) {\n      for (var j = 0; j < 4; j++) {\n        const bgNode = new Node();\n        bgNode.setPosition(new Vec3(-512 * 1.5 + 512 * j, 512 * i, 1));\n        const bgSprite = bgNode.addComponent(Sprite);\n        bgSprite.spriteFrame = bgSpriteFrame;\n        this.bgLayer.addChild(bgNode);\n        this.bgArray.push(bgNode);\n      }\n    }\n  }\n  moveBg(time, yPos) {\n    const minPos = this.bgArray[0].getPosition().y;\n    if (minPos <= -512) {\n      const bgSpriteFrame = this.assetManager.assetDic[\"DiceScene/bg\"];\n      const len = this.bgArray.length;\n      // add four\n      for (var i = 0; i < 4; i++) {\n        const lastObj = this.bgArray[len - 1 - i];\n        const lastPos = lastObj.getPosition();\n        const bgNode = new Node();\n        bgNode.setPosition(new Vec3(lastPos.x, lastPos.y + 512, lastPos.z));\n        const bgSprite = bgNode.addComponent(Sprite);\n        bgSprite.spriteFrame = bgSpriteFrame;\n        this.bgLayer.addChild(bgNode);\n        this.bgArray.push(bgNode);\n      }\n      // erase four\n      for (var i = 0; i < 4; i++) {\n        const beginNode = this.bgArray[0];\n        beginNode.removeFromParent();\n        beginNode.destroy();\n        this.bgArray.splice(0, 1);\n      }\n    }\n    for (var j in this.bgArray) {\n      const bgNode = this.bgArray[j];\n      tween(bgNode)\n        .by(time, { position: new Vec3(0, yPos, 0) })\n        .start();\n    }\n  }\n  initTile() {\n    const tilePrefab = this.assetManager.prefabDic[\"TileRail\"];\n    for (var i = 0; i < 5; i++) {\n      for (var j = 0; j < 2; j++) {\n        const tileNode = instantiate(tilePrefab);\n        tileNode.setPosition(\n          new Vec3(\n            0,\n            this.basePos.y - 773 + 773 * i - this.startIdx * this.blockSize.y,\n            1\n          )\n        );\n        if (j == 1) {\n          this.objectLayer.insertChild(tileNode, 0);\n          this.objectArray.push(tileNode);\n          tileNode.getComponent(TileRail).setTileObj((this.tileIdx++ % 3) % 3);\n        } else {\n          this.tileLayer.insertChild(tileNode, 0);\n          this.tileArray.push(tileNode);\n        }\n      }\n    }\n  }\n  moveTile(time, yPos) {\n    const minPos = this.tileArray[0].getPosition().y;\n    if (minPos <= -1100) {\n      // add one\n      const tilePrefab = this.assetManager.prefabDic[\"TileRail\"];\n      const lastTile = this.tileArray[this.tileArray.length - 1];\n      const lastPos = lastTile.getPosition();\n      for (var j = 0; j < 2; j++) {\n        const tileNode = instantiate(tilePrefab);\n        tileNode.setPosition(new Vec3(lastPos.x, lastPos.y + 773, lastPos.z));\n        if (j == 1) {\n          this.objectLayer.insertChild(tileNode, 0);\n          this.objectArray.push(tileNode);\n          tileNode.getComponent(TileRail).setTileObj((this.tileIdx++ % 3) % 3);\n        } else {\n          this.tileLayer.insertChild(tileNode, 0);\n          this.tileArray.push(tileNode);\n        }\n      }\n      // erase one\n      const firstTile = this.tileArray[0];\n      firstTile.removeFromParent();\n      firstTile.destroy();\n      this.tileArray.splice(0, 1);\n      const firstObj = this.objectArray[0];\n      firstObj.removeFromParent();\n      firstObj.destroy();\n      this.objectArray.splice(0, 1);\n    }\n    for (var t in this.tileArray) {\n      const tileNode = this.tileArray[t];\n      tween(tileNode)\n        .by(time, { position: new Vec3(0, yPos, 0) })\n        .start();\n    }\n    for (t in this.objectArray) {\n      const objNode = this.objectArray[t];\n      tween(objNode)\n        .by(time, { position: new Vec3(0, yPos, 0) })\n        .start();\n    }\n  }\n\n  update(dt) {\n    this.bgTime += dt;\n    if (this.bgTime >= 1.0 && this.bgArray.length > 0) {\n      this.bgTime = 0.0;\n      // this.moveBg(0.25, -this.blockSize.y);\n      // this.moveTile(0.25, -this.blockSize.y);\n      // this.diceManager.moveBlock(0.25, -this.blockSize.y);\n    }\n  }\n  buttonClicked(node, idx) {\n    // this.diceManager.rollWithNetwork();\n    // this.diceManager.rollWithRandom();\n    // this.diceManager.rollWithFixed([\n    //   { iconKind: 2, backKind: 1 },\n    //   { iconKind: 2, backKind: 2 },\n    //   { iconKind: 2, backKind: 3 },\n    // ]);\n    if (this.objectArray.length == 0 || this.diceManager.rolling) {\n      return;\n    }\n    this.diceManager.rollWithNetwork();\n  }\n  showDiceResult(diceResult) {\n    // console.log(diceResult);\n    const labelNode = new Node();\n    labelNode.setPosition(0, 400 - this.winSize.height / 2, 0);\n    this.node.insertChild(labelNode, 50);\n    const label = labelNode.addComponent(Label);\n    label.color = new Color(0, 0, 0, 255);\n    label.fontSize = 100;\n    label.lineHeight = 100;\n    label.string = diceResult.first + \" | \" + diceResult.second;\n    tween(labelNode)\n      .to(0.5, { scale: new Vec3(1.5, 1.5, 1) })\n      .to(0.25, { scale: new Vec3(1.0, 1.0, 1) })\n      .call(() => {\n        this.showDiceEvent(diceResult.first + diceResult.second);\n      })\n      .delay(1.0)\n      .call(() => {\n        labelNode.removeFromParent();\n        labelNode.destroy();\n      })\n      .start();\n  }\n  showDiceEvent(diceNum) {\n    var self = this;\n    const eventTween = tween(this.node);\n    for (var i = 0; i < diceNum; i++) {\n      // const eventTime = 0.1 + Math.random() * 0.1;\n      const eventTime = 0.15 + 0.01 * i;\n      eventTween\n        .call(() => {\n          self.moveStart(eventTime);\n        })\n        .delay(eventTime);\n    }\n    eventTween.start();\n  }\n  moveStart(time) {\n    // console.log(time);\n    const nextBlock = this.diceManager.getNextBlock();\n    const yDiff = nextBlock.getPosition().y - this.basePos.y;\n    this.moveBg(time, -yDiff);\n    this.moveTile(time, -yDiff);\n    this.moveLayer(time);\n    this.diceManager.moveBlock(time, -yDiff);\n  }\n\n  gotoMain() {\n    director.loadScene(\"MainScene\");\n  }\n}\n"]}