{"version":3,"sources":["file:///Users/david/Desktop/David/cocos/slot_bead/assets/scripts/Prefabs/Room/RoomTemplate.ts"],"names":["_decorator","Component","Node","instantiate","Vec3","AssetManager","ccclass","property","RoomTemplate","roomCount","onLoad","assetManager","getInstance","initRoomBlock","roomBlockPrefab","prefabDic","z","x","y","roomNode","setPosition","getBlockPosition","setScale","roomScale","gridRoomNode","addChild","roomBlockScript","getComponent","blockPosition","setRoomBlockType","roomBlockArray","push","idx","xIdx","Math","floor","Number","yIdx","setSiblingIndex","showBlock","bool","roomBlock","blockScript","blockObject","active","addDecoNode","node","order","insertChild","decoRoomNode","showDecoBlock","point","size","minX","maxX","max","minY","maxY","minZ","maxZ","i","activateBlock","deActivateBlock","getBlockTarget","placeType","targetBlock"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  Node,\n  UITransform,\n  Sprite,\n  Label,\n  tween,\n  instantiate,\n  Vec3,\n  UIOpacity,\n  UIOpacityComponent,\n} from \"cc\";\nconst { ccclass, property } = _decorator;\n\nimport AssetManager from \"../../DataManager/AssetManager\";\nimport RoomBlock from \"./RoomBlock\";\n\n@ccclass(\"RoomTemplate\")\nexport default class RoomTemplate extends Component {\n  assetManager: AssetManager = null;\n  @property(Node)\n  roomNode: Node = null;\n  @property(Node)\n  decoRoomNode: Node = null;\n  @property(Node)\n  gridRoomNode: Node = null;\n  roomBlockArray: Node[] = [];\n  roomCount = 18;\n  roomScale = 6 / this.roomCount;\n  async onLoad() {\n    this.assetManager = AssetManager.getInstance();\n    this.initRoomBlock();\n  }\n  initRoomBlock() {\n    const roomBlockPrefab = this.assetManager.prefabDic[\"RoomBlock\"];\n    for (var z = 0; z < this.roomCount; z++) {\n      for (var x = 0; x < this.roomCount; x++) {\n        for (var y = 0; y < this.roomCount; y++) {\n          // const roomIdx = i * 6 + j;\n          const roomNode = instantiate(roomBlockPrefab) as Node;\n          roomNode.setPosition(this.getBlockPosition(x, y, z));\n          roomNode.setScale(\n            new Vec3(this.roomScale, this.roomScale, this.roomScale)\n          );\n          // roomNode.getComponent(UIOpacity).opacity =\n          //   100 + 155 * (((x % 2) + (y % 2) + (z % 2)) % 2);\n          this.gridRoomNode.addChild(roomNode);\n          const roomBlockScript = roomNode.getComponent(\n            \"RoomBlock\"\n          ) as RoomBlock;\n          roomBlockScript.blockPosition = new Vec3(x, y, z);\n          if (z == 0) {\n            roomBlockScript.setRoomBlockType(1);\n            if (x == 0 && y == this.roomCount - 1) {\n              roomBlockScript.setRoomBlockType(6);\n            } else if (x == 0) {\n              roomBlockScript.setRoomBlockType(4);\n            } else if (y == this.roomCount - 1) {\n              roomBlockScript.setRoomBlockType(5);\n            }\n          } else {\n            roomBlockScript.setRoomBlockType(99);\n            if (x == 0 && y == this.roomCount - 1) {\n              roomBlockScript.setRoomBlockType(7);\n            } else if (x == 0) {\n              roomBlockScript.setRoomBlockType(2);\n            } else if (y == this.roomCount - 1) {\n              roomBlockScript.setRoomBlockType(3);\n            }\n          }\n          this.roomBlockArray.push(roomNode);\n        }\n      }\n    }\n    for (var idx in this.roomBlockArray) {\n      const xIdx = Math.floor(Number(idx) / this.roomCount);\n      const yIdx = Number(idx) % this.roomCount;\n      const roomNode = this.roomBlockArray[idx];\n      roomNode.setSiblingIndex(\n        this.roomCount * xIdx + this.roomCount - yIdx + 2\n      );\n      // console.log(xIdx, yIdx, roomNode.getSiblingIndex());\n    }\n  }\n  showBlock(bool) {\n    for (var idx in this.roomBlockArray) {\n      const roomBlock = this.roomBlockArray[idx];\n      const blockScript = roomBlock.getComponent(\"RoomBlock\") as RoomBlock;\n      blockScript.blockObject.active = bool;\n    }\n  }\n  getBlockPosition(x, y, z) {\n    return new Vec3(\n      -420 + 70 * this.roomScale * (x + y),\n      -195 +\n        20 * this.roomScale * y -\n        20 * this.roomScale * x +\n        65 * this.roomScale * z,\n      0\n    );\n  }\n  addDecoNode(node, order, bool) {\n    // this.decoRoomNode.insertChild(node, order + 1);\n    if (bool) {\n      this.gridRoomNode.insertChild(node, 1);\n    } else {\n      this.decoRoomNode.insertChild(node, order + 1);\n    }\n  }\n  showDecoBlock(point: Vec3, size: Vec3) {\n    const minX = point.x;\n    const maxX = point.x + Math.max(1, size.x);\n    const minY = point.y;\n    const maxY = point.y + Math.max(1, size.y);\n    const minZ = point.z;\n    const maxZ = point.z + Math.max(1, size.z);\n    // console.log(minX, maxX, minY, maxY, minZ, maxZ);\n    for (var i in this.roomBlockArray) {\n      const blockScript = this.roomBlockArray[i].getComponent(\n        \"RoomBlock\"\n      ) as RoomBlock;\n      if (\n        blockScript.blockPosition.x >= minX &&\n        blockScript.blockPosition.x < maxX &&\n        blockScript.blockPosition.y >= minY &&\n        blockScript.blockPosition.y < maxY &&\n        blockScript.blockPosition.z >= minZ &&\n        blockScript.blockPosition.z < maxZ\n      ) {\n        blockScript.activateBlock();\n      } else {\n        blockScript.deActivateBlock();\n      }\n    }\n  }\n  getBlockTarget(placeType) {\n    const targetBlock = [];\n    if (placeType == \"01\") {\n      for (var i in this.roomBlockArray) {\n        const blockScript = this.roomBlockArray[i].getComponent(\n          \"RoomBlock\"\n        ) as RoomBlock;\n        if (blockScript.blockPosition.z == 0) {\n          targetBlock.push(this.roomBlockArray[i]);\n        }\n      }\n    } else if (placeType == \"02\") {\n      for (var i in this.roomBlockArray) {\n        const blockScript = this.roomBlockArray[i].getComponent(\n          \"RoomBlock\"\n        ) as RoomBlock;\n        if (blockScript.blockPosition.x == 0) {\n          targetBlock.push(this.roomBlockArray[i]);\n        }\n      }\n    } else if (placeType == \"03\") {\n      for (var i in this.roomBlockArray) {\n        const blockScript = this.roomBlockArray[i].getComponent(\n          \"RoomBlock\"\n        ) as RoomBlock;\n        if (blockScript.blockPosition.y == 17) {\n          targetBlock.push(this.roomBlockArray[i]);\n        }\n      }\n    }\n    return targetBlock;\n  }\n}\n"]}