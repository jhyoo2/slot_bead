{"version":3,"sources":["file:///Users/david/Desktop/David/cocos/slot_bead/assets/scripts/Scenes/BeadNode.ts"],"names":["_decorator","Node","Vec2","RigidBody2D","SpriteFrame","Sprite","UIOpacityComponent","Collider2D","Contact2DType","BaseScene","ccclass","property","BeadNode","onLoad","myColor","Math","floor","random","node","getComponent","spriteFrame","beadFrame","collider","on","BEGIN_CONTACT","onBeginContact","selfCollider","otherCollider","contact","beadStart","myRigid","addRandomForce","bidRigid","myForce","myIdx","applyForce","x","y","diminishVelocity","rate","linearVelocity","maxVelocity","update","dt","sqrt","pow","maxForce","preVelo","angularVelocity","coverNode","opacity"],"mappings":"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","sourcesContent":["import {\r\n  _decorator,\r\n  size,\r\n  director,\r\n  Node,\r\n  PhysicsSystem2D,\r\n  Vec2,\r\n  PHYSICS_2D_PTM_RATIO,\r\n  EPhysics2DDrawFlags,\r\n  RigidBody,\r\n  Vec3,\r\n  RigidBody2D,\r\n  Prefab,\r\n  instantiate,\r\n  SpriteFrame,\r\n  Sprite,\r\n  UIOpacityComponent,\r\n  Collider2D,\r\n  Contact2DType,\r\n  IPhysics2DContact,\r\n} from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\n\r\nimport BaseScene from \"../BaseObject/BaseScene\";\r\nimport AssetManager from \"../DataManager/AssetManager\";\r\nimport BaseRoom from \"../Prefabs/Room/BaseRoom\";\r\n\r\n@ccclass(\"BeadNode\")\r\nexport class BeadNode extends BaseScene {\r\n  beadStart = false;\r\n  myForce = 0;\r\n  myColor = 0;\r\n  myIdx = 0;\r\n\r\n  @property(Node)\r\n  coverNode: Node | null = null;\r\n\r\n  @property(SpriteFrame)\r\n  beadFrame: SpriteFrame[] = [];\r\n\r\n  maxForce = 0;\r\n  maxVelocity = new Vec2(0, 0);\r\n\r\n  async onLoad() {\r\n    super.onLoad();\r\n    const myColor = Math.floor(Math.random() * 5) + 1;\r\n    this.node.getComponent(Sprite).spriteFrame = this.beadFrame[myColor];\r\n    let collider = this.getComponent(Collider2D);\r\n    if (collider) {\r\n      collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n    }\r\n  }\r\n\r\n  onBeginContact(\r\n    selfCollider: Collider2D,\r\n    otherCollider: Collider2D,\r\n    contact: IPhysics2DContact | null\r\n  ) {\r\n    if (this.beadStart) {\r\n      const myColor = Math.floor(Math.random() * 3) + 1;\r\n      this.node.getComponent(Sprite).spriteFrame = this.beadFrame[myColor];\r\n    }\r\n    if (otherCollider.node.getComponent(BeadNode)) {\r\n      const myRigid = this.node.getComponent(RigidBody2D);\r\n      // myRigid.linearVelocity = new Vec2(\r\n      //   Math.max(this.maxVelocity.x, myRigid.linearVelocity.x * 2.2),\r\n      //   Math.max(this.maxVelocity.y, myRigid.linearVelocity.y * 2.2)\r\n      // );\r\n    }\r\n  }\r\n\r\n  addRandomForce() {\r\n    this.beadStart = true;\r\n    const bidRigid = this.node.getComponent(RigidBody2D);\r\n    const myForce = new Vec2(\r\n      -40000 + 80000 * Math.random(),\r\n      90000 + 30000 * Math.random() + 10000 * this.myIdx\r\n    );\r\n    bidRigid.applyForce(\r\n      myForce,\r\n      new Vec2(myForce.x / 100, myForce.y / 100),\r\n      true\r\n    );\r\n  }\r\n\r\n  diminishVelocity(rate) {\r\n    const bidRigid = this.node.getComponent(RigidBody2D);\r\n    bidRigid.linearVelocity = new Vec2(\r\n      bidRigid.linearVelocity.x * rate,\r\n      bidRigid.linearVelocity.y * rate\r\n    );\r\n    this.maxVelocity = new Vec2(\r\n      this.maxVelocity.x * rate,\r\n      this.maxVelocity.y * rate\r\n    );\r\n  }\r\n\r\n  update(dt) {\r\n    if (!this.beadStart) {\r\n      return;\r\n    }\r\n    const bidRigid = this.node.getComponent(RigidBody2D);\r\n\r\n    const myForce = Math.sqrt(\r\n      Math.pow(bidRigid.linearVelocity.x, 2) +\r\n        Math.pow(bidRigid.linearVelocity.y, 2)\r\n    );\r\n    if (this.maxForce < myForce) {\r\n      this.maxForce = myForce;\r\n      this.maxVelocity = new Vec2(\r\n        bidRigid.linearVelocity.x,\r\n        bidRigid.linearVelocity.y\r\n      );\r\n    }\r\n    this.myForce += myForce;\r\n    if (myForce > 0) {\r\n      const preVelo = bidRigid.linearVelocity;\r\n      if (myForce <= 0.1) {\r\n        bidRigid.linearVelocity = new Vec2(0, 0);\r\n        bidRigid.angularVelocity = 0;\r\n        this.coverNode.getComponent(UIOpacityComponent).opacity = 0;\r\n        this.beadStart = false;\r\n      } else if (myForce > 10) {\r\n        bidRigid.linearVelocity = new Vec2(\r\n          preVelo.x * 0.9975 + 0.001 * this.myIdx,\r\n          preVelo.y * 0.9975 + 0.001 * this.myIdx\r\n        );\r\n      } else if (myForce > 1) {\r\n        bidRigid.linearVelocity = new Vec2(\r\n          preVelo.x * 0.985 + 0.0005 * this.myIdx,\r\n          preVelo.y * 0.985 + 0.0005 * this.myIdx\r\n        );\r\n      } else {\r\n        bidRigid.linearVelocity = new Vec2(\r\n          preVelo.x * 0.95 + 0.001 * this.myIdx,\r\n          preVelo.y * 0.95 + 0.001 * this.myIdx\r\n        );\r\n      }\r\n      if (myForce <= 3) {\r\n        this.coverNode.getComponent(UIOpacityComponent).opacity =\r\n          (myForce / 3) * 255;\r\n      }\r\n    }\r\n    // console.log(myForce);\r\n  }\r\n}\r\n"]}