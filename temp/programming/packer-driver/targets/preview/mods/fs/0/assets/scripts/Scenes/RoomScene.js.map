{"version":3,"sources":["file:///Users/david/Desktop/David/cocos/slot_temp1/assets/scripts/Scenes/RoomScene.ts"],"names":["_decorator","Node","instantiate","Vec3","ImageAsset","Sprite","SpriteFrame","Texture2D","UITransform","UIOpacityComponent","EditBox","BaseScene","AssetManager","uuidv4","DecoMaster","DecoAlert","ccclass","property","RoomScene","onLoad","setWideResolution","assetManager","getInstance","loadAssets","assetResult","roomNode","prefabDic","scale","node","insertChild","roomScript","getComponent","showBlock","decoMaster","setPosition","winSize","width","height","sceneScript","addChild","fileMaster","fileScript","decoDic","on","EventType","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","showGrid","isChecked","addDecoData","decoObject","tag","activeDeco","decoData","initDefaultDeco","decoId","placeType","keys","Object","zOrder","i","label","String","length","imgNode","getImgNode","img","imgSprite","sizeMode","SizeMode","RAW","trim","spriteFrame","console","log","objectArray","push","objectId","id","objectIdx","objectPoint","objectSize","objectPlace","imgURL","imgFile","file","shadowFrame","shadowFile","buyType","cashPrice","j","Number","labelArray","imgSize","contentSize","xSize","Math","min","ceil","ySize","decoPoint","floor","zSize","TOUCH_START","event","propagationStopped","onDecoSelected","nodeOrder","addDecoNode","updateDecoPoint","placeDeco","selectedDeco","anchorType","resetDecoObject","updateFileMaster","imgResult","imgAsset","tex","image","texture","decoType","opacity","stackable","stackSize","defaultObjectId","eraseDeco","removeFromParent","setDecoData","kind","obj","setObjectData","getAnchorPoint","updateDecoPlace","point","size","anchor","x","max","y","z","getBlockPosition","showDecoBlock","checkDecoData","onFileSelected","fileData","location","touch","getUILocation","zeroPos","sizePos","targetList","getBlockTarget","targetBlock","baseDis","block","distance","sqrt","pow","getWorldPosition","blockScript","blockPosition","simulate","setSelectedDeco","idx","assetDic","replaceDeco","imgPos","imgDistance","shadowPos","shadowNode","shadowDistance","replaceObjImage","replaceImg","imgObject","sendImage","fileName","fetch","method","headers","body","JSON","stringify","r","text","parse","sendData","collection","doc","data","loadData","roomId","roomDecoSelected","selectedIdx","decoKeys","key","resetRoomDeco","modalLayer","setModalColor","alertPrefab","alertScript","setTitleLabel","setMainLabel","self","yesEvent","updateObjectImg","removeObjDic","removeAlert","loadRoomDeco","editNodeActive","editBox","editLabelNode","string","buttonActive","roomDataResult","roomData","decoArray","objectDic","updateRoomDeco","updateImages","objectData","loadImgFromURL","fileResult","addImgObj","saveRoomDeco","progress","objList","decoList","roomDic","docoArray","decoKey","decoObjList","copyObj","assign","result","url","objectResult","copyDeco","decoResult","roomResult","noButtonActive"],"mappings":"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","sourcesContent":["import {\r\n  _decorator,\r\n  Node,\r\n  instantiate,\r\n  Vec3,\r\n  ImageAsset,\r\n  Sprite,\r\n  SpriteFrame,\r\n  Texture2D,\r\n  UITransform,\r\n  Size,\r\n  UIOpacityComponent,\r\n  JsonAsset,\r\n  EditBox,\r\n  UITransformComponent,\r\n} from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\n\r\nimport BaseScene from \"../BaseObject/BaseScene\";\r\nimport AssetManager from \"../DataManager/AssetManager\";\r\nimport RoomTemplate from \"../Prefabs/Room/RoomTemplate\";\r\nimport { uuidv4 } from \"../Common/Module\";\r\nimport DecoMaster from \"../Prefabs/Deco/DecoMaster\";\r\nimport FileMaster from \"../Prefabs/Deco/FileMaster\";\r\nimport RoomBlock from \"../Prefabs/Room/RoomBlock\";\r\n\r\nimport {\r\n  Deco,\r\n  DecoObj,\r\n  FileObject,\r\n  DecoType,\r\n  PlaceType,\r\n  AnchorType,\r\n} from \"../Prefabs/Deco/DecoTypes\";\r\nimport DecoAlert from \"../Prefabs/Deco/DecoAlert\";\r\n\r\n@ccclass(\"RoomScene\")\r\nexport class RoomScene extends BaseScene {\r\n  assetManager: AssetManager = null;\r\n\r\n  // (1) room node\r\n  roomNode: Node = null;\r\n  roomId = uuidv4();\r\n  // roomTemplate: RoomTemplate = null;\r\n\r\n  // (5) deco data\r\n  decoMaster: Node = null;\r\n  fileMaster: Node = null;\r\n  activeDeco: Deco = null;\r\n  // activeObject = 0;\r\n  selectedDeco: Node = null;\r\n  decoDic: { [name: string]: Deco } = {};\r\n  selectedIdx = 0;\r\n\r\n  async onLoad() {\r\n    super.setWideResolution();\r\n    this.assetManager = AssetManager.getInstance();\r\n    const assetResult = await this.assetManager.loadAssets();\r\n    const roomNode = instantiate(this.assetManager.prefabDic[\"RoomTemplate\"]);\r\n    // roomNode.setPosition(new Vec3(0, 250, 0));\r\n    roomNode.scale = new Vec3(1.5, 1.5, 1.5);\r\n    // roomNode.scale = new Vec3(1.25, 1.25, 1.25);\r\n    this.node.insertChild(roomNode, 10);\r\n    this.roomNode = roomNode;\r\n    const roomScript = this.roomNode.getComponent(\r\n      \"RoomTemplate\"\r\n    ) as RoomTemplate;\r\n    roomScript.showBlock(false);\r\n\r\n    // set deco master\r\n    const decoMaster = instantiate(this.assetManager.prefabDic[\"DecoMaster\"]);\r\n    decoMaster.setPosition(\r\n      new Vec3(this.winSize.width / 2 - 370, this.winSize.height / 2, 1)\r\n    );\r\n    decoMaster.getComponent(\"DecoMaster\").sceneScript = this;\r\n    this.node.addChild(decoMaster);\r\n    this.decoMaster = decoMaster;\r\n\r\n    // set file master\r\n    const fileMaster = instantiate(this.assetManager.prefabDic[\"FileMaster\"]);\r\n    fileMaster.setPosition(\r\n      new Vec3(-this.winSize.width / 2 + 370, this.winSize.height / 2, 1)\r\n    );\r\n    this.node.addChild(fileMaster);\r\n    const fileScript = fileMaster.getComponent(\"FileMaster\") as FileMaster;\r\n    fileScript.sceneScript = this;\r\n    fileScript.decoDic = this.decoDic;\r\n    this.fileMaster = fileMaster;\r\n\r\n    // add touchEvent\r\n    this.node.on(Node.EventType.TOUCH_MOVE, this.onTouchMove, this, true);\r\n    this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this, true);\r\n    this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this, true);\r\n  }\r\n  showGrid(node) {\r\n    const roomScript = this.roomNode.getComponent(\r\n      \"RoomTemplate\"\r\n    ) as RoomTemplate;\r\n    roomScript.showBlock(node.isChecked);\r\n  }\r\n  /////// ////////////////////////////\r\n  // (1) select deco\r\n  addDecoData(decoObject: FileObject, tag) {\r\n    if (this.activeDeco) {\r\n      this.activeDeco = null;\r\n    }\r\n    // add deco data\r\n    const decoData = this.initDefaultDeco(decoObject);\r\n    this.decoDic[decoData.decoId] = decoData;\r\n    this.activeDeco = decoData;\r\n    this.activeDeco.placeType = tag;\r\n    const keys = Object.keys(this.decoDic);\r\n    let zOrder = 0;\r\n    for (var i in keys) {\r\n      if (this.decoDic[keys[i]].placeType == tag) {\r\n        zOrder++;\r\n      }\r\n    }\r\n    this.activeDeco.label = \"오브젝트\" + String(keys.length);\r\n    this.activeDeco.zOrder = zOrder;\r\n\r\n    // add deco image\r\n    const imgNode = this.getImgNode(decoObject.img);\r\n    const imgSprite = imgNode.getComponent(Sprite);\r\n    imgSprite.sizeMode = Sprite.SizeMode.RAW;\r\n    imgSprite.trim = true;\r\n    imgSprite.spriteFrame = imgSprite.spriteFrame;\r\n    console.log(imgNode);\r\n\r\n    this.activeDeco.objectArray.push({\r\n      objectId: decoObject.id,\r\n      objectIdx: 0,\r\n      decoId: decoData.decoId,\r\n      objectPoint: new Vec3(0, 0, 0),\r\n      objectSize: new Vec3(1, 1, 1),\r\n      objectPlace: new Vec3(0, 0, 0),\r\n      imgURL: \"\",\r\n      spriteFrame: imgSprite.spriteFrame,\r\n      imgFile: decoObject.file,\r\n      shadowFrame: \"\",\r\n      shadowFile: \"\",\r\n      buyType: \"00\",\r\n      cashPrice: 0,\r\n    });\r\n    for (var j = 0; j < 2; j++) {\r\n      this.activeDeco.objectArray.push({\r\n        objectId: \"\",\r\n        objectIdx: Number(j) + 1,\r\n        decoId: decoData.decoId,\r\n        objectPoint: new Vec3(0, 0, 0),\r\n        objectSize: new Vec3(1, 1, 1),\r\n        objectPlace: new Vec3(0, 0, 0),\r\n        imgURL: \"\",\r\n        spriteFrame: \"\",\r\n        imgFile: \"\",\r\n        shadowFrame: \"\",\r\n        shadowFile: \"\",\r\n        buyType: \"00\",\r\n        cashPrice: 0,\r\n      });\r\n    }\r\n    const labelArray = [\"전체(0)\", \"바닥(0)\", \"왼쪽 벽(0)\", \"오른쪽 벽(0)\"];\r\n    const imgSize = (imgNode.getComponent(UITransform) as UITransform)\r\n      .contentSize;\r\n    if (tag == \"01\") {\r\n      const xSize = Math.min(18, Math.ceil(imgSize.width / (140 / 3)));\r\n      const ySize = Math.min(18, Math.ceil(imgSize.height / (40 / 3)));\r\n      this.activeDeco.objectArray[0].objectSize = new Vec3(xSize, ySize, 0);\r\n      this.activeDeco.decoPoint = new Vec3(\r\n        9 - Math.floor(xSize / 2),\r\n        9 - Math.floor(ySize / 2),\r\n        0\r\n      );\r\n    } else if (tag == \"02\") {\r\n      const ySize = Math.min(18, Math.ceil(imgSize.width / (70 / 3)));\r\n      const zSize = Math.min(18, Math.ceil(imgSize.height / (85 / 3)));\r\n      this.activeDeco.objectArray[0].objectSize = new Vec3(0, ySize, zSize);\r\n      this.activeDeco.decoPoint = new Vec3(\r\n        0,\r\n        9 - Math.floor(ySize / 2),\r\n        9 - Math.floor(zSize / 2)\r\n      );\r\n    } else if (tag == \"03\") {\r\n      const xSize = Math.min(18, Math.ceil(imgSize.width / (70 / 3)));\r\n      const zSize = Math.min(18, Math.ceil(imgSize.height / (85 / 3)));\r\n      this.activeDeco.objectArray[0].objectSize = new Vec3(xSize, 0, zSize);\r\n      this.activeDeco.decoPoint = new Vec3(\r\n        9 - Math.floor(xSize / 2),\r\n        17,\r\n        9 - Math.floor(zSize / 2)\r\n      );\r\n    }\r\n    // console.log(this.activeDeco.objectArray[0].objectSize);\r\n    // console.log(this.activeDeco.decoPoint);\r\n\r\n    if (decoData.placeType != \"00\") {\r\n      imgNode.on(\r\n        Node.EventType.TOUCH_START,\r\n        (event) => {\r\n          event.propagationStopped = true;\r\n          this.onDecoSelected(decoData);\r\n        },\r\n        this\r\n      );\r\n    }\r\n    let nodeOrder = Object.keys(this.decoDic).length;\r\n    // if (tag == \"00\") {\r\n    //   nodeOrder = 99;\r\n    // }\r\n    (this.roomNode.getComponent(\"RoomTemplate\") as RoomTemplate).addDecoNode(\r\n      imgNode,\r\n      nodeOrder,\r\n      tag == \"00\"\r\n    );\r\n    this.activeDeco.node = imgNode;\r\n\r\n    // set deco position\r\n    this.updateDecoPoint();\r\n    this.placeDeco(\r\n      this.activeDeco.node,\r\n      this.activeDeco.decoPoint,\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectPoint,\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize,\r\n      this.activeDeco.anchorType\r\n    );\r\n\r\n    // reset deco & file master\r\n    const decoMaster = this.decoMaster.getComponent(\"DecoMaster\") as DecoMaster;\r\n    decoMaster.resetDecoObject();\r\n    const fileMaster = this.fileMaster.getComponent(\"FileMaster\") as FileMaster;\r\n    fileMaster.updateFileMaster();\r\n    decoMaster.decoData = this.activeDeco;\r\n  }\r\n  getImgNode(imgResult) {\r\n    // set sprite frame\r\n    const imgAsset = new ImageAsset(imgResult);\r\n    const spriteFrame = new SpriteFrame();\r\n    const tex = new Texture2D();\r\n    tex.image = imgAsset;\r\n    spriteFrame.texture = tex;\r\n\r\n    // set node\r\n    const node = instantiate(this.assetManager.prefabDic[\"ImageNode\"]);\r\n    node.getComponent(Sprite).spriteFrame = spriteFrame;\r\n    // node.getComponent(UITransform).setContentSize(new Size(180, 180));\r\n    return node;\r\n  }\r\n\r\n  initDefaultDeco(decoObject: FileObject): Deco {\r\n    return {\r\n      decoId: uuidv4(),\r\n      selectedDeco: 0,\r\n      decoType: \"00\" as DecoType,\r\n      placeType: \"00\" as PlaceType,\r\n      decoPoint: new Vec3(0, 0, 0),\r\n      anchorType: \"00\" as AnchorType,\r\n      opacity: 1.0,\r\n      stackable: false,\r\n      stackSize: new Vec3(1, 1, 1),\r\n      defaultObjectId: decoObject.id,\r\n      objectArray: [],\r\n      zOrder: 0,\r\n      node: null,\r\n      label: \"\",\r\n    };\r\n  }\r\n\r\n  eraseDeco() {\r\n    if (this.activeDeco) {\r\n      if (this.activeDeco.node) {\r\n        this.activeDeco.node.removeFromParent();\r\n      }\r\n      const decoId = this.activeDeco.decoId;\r\n      delete this.decoDic[decoId];\r\n      this.activeDeco = null;\r\n    }\r\n    const decoMaster = this.decoMaster.getComponent(\"DecoMaster\") as DecoMaster;\r\n    decoMaster.resetDecoObject();\r\n    const fileMaster = this.fileMaster.getComponent(\"FileMaster\") as FileMaster;\r\n    fileMaster.updateFileMaster();\r\n  }\r\n\r\n  setDecoData(kind, obj) {\r\n    // console.log(kind, obj);\r\n    this.activeDeco[kind] = obj.tag;\r\n    if (kind == \"opacity\") {\r\n      this.activeDeco.node.getComponent(UIOpacityComponent).opacity =\r\n        obj.tag * 255;\r\n      return;\r\n    }\r\n    // console.log(kind, obj);\r\n    if (kind == \"decoType\" || kind == \"placeType\") {\r\n      this.updateDecoPoint();\r\n    }\r\n\r\n    if (\r\n      kind == \"decoType\" ||\r\n      kind == \"placeType\" ||\r\n      kind == \"decoPoint\" ||\r\n      kind == \"anchorType\"\r\n    ) {\r\n      this.placeDeco(\r\n        this.activeDeco.node,\r\n        this.activeDeco.decoPoint,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectPoint,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize,\r\n        this.activeDeco.anchorType\r\n      );\r\n    }\r\n  }\r\n  setObjectData(kind, obj) {\r\n    // console.log(kind, obj);\r\n    this.activeDeco.objectArray[this.activeDeco.selectedDeco][kind] = obj.tag;\r\n    if (kind == \"objectSize\" || kind == \"objectPoint\") {\r\n      this.placeDeco(\r\n        this.activeDeco.node,\r\n        this.activeDeco.decoPoint,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectPoint,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize,\r\n        this.activeDeco.anchorType\r\n      );\r\n    }\r\n  }\r\n  updateDecoPoint() {\r\n    // console.log(kind, obj);\r\n    switch (this.activeDeco.decoType + this.activeDeco.placeType) {\r\n      case \"0101\":\r\n        this.activeDeco.decoPoint = new Vec3(0, 0, 0);\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(18, 18, 0);\r\n        this.activeDeco.stackable = true;\r\n        this.activeDeco.stackSize = new Vec3(18, 18, 0);\r\n        this.activeDeco.anchorType = \"01\";\r\n        break;\r\n      case \"0202\":\r\n        this.activeDeco.decoPoint = new Vec3(0, 0, 0);\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(0, 18, 18);\r\n        this.activeDeco.stackable = true;\r\n        this.activeDeco.stackSize = new Vec3(0, 18, 18);\r\n        this.activeDeco.anchorType = \"02\";\r\n        break;\r\n      case \"0203\":\r\n        this.activeDeco.decoPoint = new Vec3(0, 17, 0);\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(18, 0, 18);\r\n        this.activeDeco.stackable = true;\r\n        this.activeDeco.stackSize = new Vec3(18, 0, 18);\r\n        this.activeDeco.anchorType = \"03\";\r\n        break;\r\n      default:\r\n        this.activeDeco.anchorType = \"00\";\r\n        if (this.activeDeco.placeType == \"00\") {\r\n          this.activeDeco.decoPoint = new Vec3(8.5, 8.5, 8.5);\r\n        }\r\n    }\r\n  }\r\n  getAnchorPoint(anchorType) {\r\n    if (anchorType == \"00\") {\r\n      return new Vec3(0.5, 0.5, 0.5);\r\n    } else if (anchorType == \"01\") {\r\n      return new Vec3(0.5, 0.5, 0.0);\r\n    } else if (anchorType == \"02\") {\r\n      return new Vec3(0, 0.5, 0.5);\r\n    } else if (anchorType == \"03\") {\r\n      return new Vec3(0.5, 1, 0.5);\r\n    }\r\n  }\r\n  updateDecoPlace() {\r\n    const point = this.activeDeco.decoPoint;\r\n    const objectPoint =\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectPoint;\r\n    const size =\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize;\r\n    const anchorType = this.activeDeco.anchorType;\r\n    const anchor = this.getAnchorPoint(anchorType);\r\n    const decoPoint = new Vec3(\r\n      point.x + objectPoint.x + Math.max(1, size.x) / 2 + (anchor.x - 0.5),\r\n      point.y + objectPoint.y + Math.max(1, size.y) / 2 + (anchor.y - 0.5),\r\n      point.z + objectPoint.z + Math.max(1, size.z) / 2 + (anchor.z - 0.5)\r\n    );\r\n    // console.log(decoPoint);\r\n    const roomScript = this.roomNode.getComponent(\r\n      \"RoomTemplate\"\r\n    ) as RoomTemplate;\r\n    this.activeDeco.node.setPosition(\r\n      roomScript.getBlockPosition(decoPoint.x, decoPoint.y, decoPoint.z)\r\n    );\r\n  }\r\n  placeDeco(node, point, objectPoint, size, anchorType) {\r\n    const anchor = this.getAnchorPoint(anchorType);\r\n    const decoPoint = new Vec3(\r\n      point.x + objectPoint.x + Math.max(1, size.x) / 2 + (anchor.x - 0.5),\r\n      point.y + objectPoint.y + Math.max(1, size.y) / 2 + (anchor.y - 0.5),\r\n      point.z + objectPoint.z + Math.max(1, size.z) / 2 + (anchor.z - 0.5)\r\n    );\r\n    // console.log(decoPoint);\r\n    const roomScript = this.roomNode.getComponent(\r\n      \"RoomTemplate\"\r\n    ) as RoomTemplate;\r\n    node.setPosition(\r\n      roomScript.getBlockPosition(decoPoint.x, decoPoint.y, decoPoint.z)\r\n    );\r\n    this.showDecoBlock(point, size);\r\n  }\r\n  showDecoBlock(point, size) {\r\n    const roomScript = this.roomNode.getComponent(\r\n      \"RoomTemplate\"\r\n    ) as RoomTemplate;\r\n    roomScript.showDecoBlock(point, size);\r\n  }\r\n  checkDecoData() {\r\n    console.log(this.activeDeco);\r\n  }\r\n\r\n  //////////////\r\n  onFileSelected(fileData) {\r\n    // reset deco & file master\r\n    const decoMaster = this.decoMaster.getComponent(\"DecoMaster\") as DecoMaster;\r\n    decoMaster.resetDecoObject();\r\n    const fileMaster = this.fileMaster.getComponent(\"FileMaster\") as FileMaster;\r\n    fileMaster.updateFileMaster();\r\n\r\n    // set decodata\r\n    this.activeDeco = fileData;\r\n    decoMaster.decoData = this.activeDeco;\r\n    this.showDecoBlock(\r\n      this.activeDeco.decoPoint,\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize\r\n    );\r\n  }\r\n  onDecoSelected(decoData: Deco) {\r\n    this.activeDeco = decoData;\r\n    const decoMaster = this.decoMaster.getComponent(\"DecoMaster\") as DecoMaster;\r\n    decoMaster.resetDecoObject();\r\n    decoMaster.decoData = this.activeDeco;\r\n    this.showDecoBlock(\r\n      this.activeDeco.decoPoint,\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize\r\n    );\r\n    this.selectedDeco = decoData.node;\r\n  }\r\n\r\n  onTouchMove(event) {\r\n    if (this.selectedDeco) {\r\n      const location = event.touch.getUILocation();\r\n      const placeType = this.activeDeco.placeType;\r\n      const roomScript = this.roomNode.getComponent(\r\n        \"RoomTemplate\"\r\n      ) as RoomTemplate;\r\n      const zeroPos = roomScript.getBlockPosition(0, 0, 0);\r\n      const sizePos = roomScript.getBlockPosition(\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize.x,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize.y,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize.z\r\n      );\r\n      const targetList = roomScript.getBlockTarget(placeType);\r\n      let targetBlock = null;\r\n      let baseDis = 150;\r\n      for (var i in targetList) {\r\n        const block = targetList[i] as Node;\r\n        const distance = Math.sqrt(\r\n          Math.pow(\r\n            block.getWorldPosition().x -\r\n              (location.x - (sizePos.x - zeroPos.x) / 2),\r\n            2\r\n          ) +\r\n            Math.pow(\r\n              block.getWorldPosition().y -\r\n                (location.y - (sizePos.y - zeroPos.y) / 2),\r\n              2\r\n            )\r\n        );\r\n        if (distance < baseDis) {\r\n          baseDis = distance;\r\n          targetBlock = block;\r\n        }\r\n      }\r\n      if (targetBlock) {\r\n        const blockScript = targetBlock.getComponent(\"RoomBlock\") as RoomBlock;\r\n        this.activeDeco.decoPoint = blockScript.blockPosition;\r\n        this.updateDecoPlace();\r\n      }\r\n      // this.selectedDeco.setWorldPosition(new Vec3(location.x, location.y, 1));\r\n    }\r\n  }\r\n  onTouchEnd(event) {\r\n    // console.log(\"touc end\", event);\r\n    if (!event.simulate && this.selectedDeco) {\r\n      this.selectedDeco = null;\r\n    }\r\n  }\r\n  //////////////\r\n  setSelectedDeco(idx) {\r\n    if (this.activeDeco) {\r\n      this.activeDeco.selectedDeco = idx;\r\n      // console.log(this.activeDeco);\r\n      if (this.activeDeco.objectArray[idx].spriteFrame) {\r\n        this.activeDeco.node.getComponent(Sprite).spriteFrame =\r\n          this.activeDeco.objectArray[idx].spriteFrame;\r\n        this.updateDecoPlace();\r\n      } else {\r\n        if (this.activeDeco.node) {\r\n          this.activeDeco.node.getComponent(Sprite).spriteFrame =\r\n            this.assetManager.assetDic[\"Deco/default_sprite\"];\r\n        }\r\n      }\r\n    }\r\n  }\r\n  replaceDeco(kind, point, obj?) {\r\n    if (this.activeDeco) {\r\n      const imgPos = this.decoMaster\r\n        .getComponent(DecoMaster)\r\n        .imgNode.getWorldPosition();\r\n      const imgDistance = Math.sqrt(\r\n        Math.pow(imgPos.x - point.x, 2) + Math.pow(imgPos.y - point.y, 2)\r\n      );\r\n      const shadowPos = this.decoMaster\r\n        .getComponent(DecoMaster)\r\n        .shadowNode.getWorldPosition();\r\n      const shadowDistance = Math.sqrt(\r\n        Math.pow(shadowPos.x - point.x, 2) + Math.pow(shadowPos.y - point.y, 2)\r\n      );\r\n      if (kind == \"touchEnd\") {\r\n        if (imgDistance <= 150) {\r\n          this.replaceObjImage(0, obj);\r\n          this.decoMaster.getComponent(DecoMaster).replaceImg(0, obj);\r\n        } else if (shadowDistance <= 150) {\r\n          this.replaceObjImage(1, obj);\r\n          this.decoMaster.getComponent(DecoMaster).replaceImg(1, obj);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  replaceObjImage(kind, imgObject) {\r\n    const imgAsset = new ImageAsset(imgObject.img);\r\n    const spriteFrame = new SpriteFrame();\r\n    const tex = new Texture2D();\r\n    tex.image = imgAsset;\r\n    spriteFrame.texture = tex;\r\n    if (\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectId == \"\"\r\n    ) {\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectId =\r\n        uuidv4();\r\n    }\r\n\r\n    if (kind == 1) {\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].shadowFile =\r\n        imgObject.file;\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].shadowFrame =\r\n        spriteFrame;\r\n      return;\r\n    }\r\n\r\n    if (kind == 0) {\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].imgFile =\r\n        imgObject.file;\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].spriteFrame =\r\n        spriteFrame;\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].imgURL = \"\";\r\n      this.activeDeco.node.getComponent(Sprite).spriteFrame = spriteFrame;\r\n    }\r\n\r\n    if (this.activeDeco.selectedDeco == 0) {\r\n      const tag = this.activeDeco.placeType;\r\n      if (tag == \"01\") {\r\n        const xSize = Math.min(18, Math.ceil(spriteFrame.width / (140 / 3)));\r\n        const ySize = Math.min(18, Math.ceil(spriteFrame.height / (40 / 3)));\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(xSize, ySize, 0);\r\n      } else if (tag == \"02\") {\r\n        const ySize = Math.min(18, Math.ceil(spriteFrame.width / (70 / 3)));\r\n        const zSize = Math.min(18, Math.ceil(spriteFrame.height / (85 / 3)));\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(0, ySize, zSize);\r\n      } else if (tag == \"03\") {\r\n        const xSize = Math.min(18, Math.ceil(spriteFrame.width / (70 / 3)));\r\n        const zSize = Math.min(18, Math.ceil(spriteFrame.height / (85 / 3)));\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(xSize, 0, zSize);\r\n      }\r\n    } else {\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectPoint =\r\n        this.activeDeco.objectArray[0].objectPoint;\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n        this.activeDeco.objectArray[0].objectSize;\r\n    }\r\n    this.updateDecoPlace();\r\n  }\r\n  //////////////\r\n  async sendImage(fileName, img) {\r\n    // (1) send images\r\n    const r = await fetch(\r\n      \"https://us-central1-slot-deco.cloudfunctions.net/uploadImage\",\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Access-Control-Allow-Origin\": \"*\",\r\n        },\r\n        body: JSON.stringify({\r\n          image: String(img),\r\n          fileName: fileName,\r\n        }),\r\n      }\r\n    );\r\n    return JSON.parse(await r.text());\r\n    // console.log(result);\r\n  }\r\n\r\n  async sendData(collection, doc, data) {\r\n    // (1) save datas\r\n    const r = await fetch(\r\n      \"https://us-central1-slot-deco.cloudfunctions.net/uploadData\",\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Access-Control-Allow-Origin\": \"*\",\r\n        },\r\n        body: JSON.stringify({\r\n          collection: String(collection),\r\n          doc: String(doc),\r\n          data: JSON.stringify(data),\r\n        }),\r\n      }\r\n    );\r\n    return JSON.parse(await r.text());\r\n  }\r\n\r\n  async loadData(roomId) {\r\n    // (1) save datas\r\n    const r = await fetch(\r\n      \"https://us-central1-slot-deco.cloudfunctions.net/getRoomData\",\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Access-Control-Allow-Origin\": \"*\",\r\n        },\r\n        body: JSON.stringify({\r\n          roomId: roomId,\r\n        }),\r\n      }\r\n    );\r\n    return JSON.parse(await r.text());\r\n  }\r\n\r\n  roomDecoSelected(node, idx) {\r\n    this.selectedIdx = Number(idx);\r\n    const decoKeys = Object.keys(this.decoDic);\r\n    for (var i in decoKeys) {\r\n      const key = decoKeys[i];\r\n      const decoObject = this.decoDic[key];\r\n      decoObject.selectedDeco = this.selectedIdx;\r\n\r\n      if (decoObject.objectArray[this.selectedIdx].spriteFrame) {\r\n        decoObject.node.getComponent(Sprite).spriteFrame =\r\n          decoObject.objectArray[this.selectedIdx].spriteFrame;\r\n      } else {\r\n        decoObject.node.getComponent(Sprite).spriteFrame =\r\n          this.assetManager.assetDic[\"Deco/default_sprite\"];\r\n      }\r\n\r\n      this.placeDeco(\r\n        decoObject.node,\r\n        decoObject.decoPoint,\r\n        decoObject.objectArray[decoObject.selectedDeco].objectPoint,\r\n        decoObject.objectArray[decoObject.selectedDeco].objectSize,\r\n        decoObject.anchorType\r\n      );\r\n    }\r\n  }\r\n  //////////\r\n  resetRoomDeco() {\r\n    this.roomId = uuidv4();\r\n    const modalLayer = this.setModalColor();\r\n    const alertPrefab = instantiate(this.assetManager.prefabDic[\"DecoAlert\"]);\r\n    modalLayer.addChild(alertPrefab);\r\n    const alertScript = alertPrefab.getComponent(DecoAlert);\r\n    alertScript.setTitleLabel(\"방 초기화\");\r\n    alertScript.setMainLabel(\"모든 방의 데코레이션을 초기화하시겠습니까?\");\r\n    var self = this;\r\n    alertScript.yesEvent = () => {\r\n      const decoKeys = Object.keys(self.decoDic);\r\n      for (var i in decoKeys) {\r\n        const key = decoKeys[i];\r\n        if (self.decoDic[key].node) {\r\n          this.decoDic[key].node.removeFromParent();\r\n        }\r\n        delete self.decoDic[key];\r\n      }\r\n      this.eraseDeco();\r\n      const decoMaster = this.decoMaster.getComponent(\r\n        \"DecoMaster\"\r\n      ) as DecoMaster;\r\n      decoMaster.updateObjectImg();\r\n      const fileMaster = this.fileMaster.getComponent(\r\n        \"FileMaster\"\r\n      ) as FileMaster;\r\n      fileMaster.removeObjDic();\r\n      alertScript.removeAlert();\r\n    };\r\n  }\r\n  async loadRoomDeco() {\r\n    const modalLayer = this.setModalColor();\r\n    const alertPrefab = instantiate(this.assetManager.prefabDic[\"DecoAlert\"]);\r\n    modalLayer.addChild(alertPrefab);\r\n    const alertScript = alertPrefab.getComponent(DecoAlert);\r\n    alertScript.setTitleLabel(\"데코레이션 불러오기\");\r\n    alertScript.editNodeActive(true);\r\n    var self = this;\r\n    alertScript.yesEvent = async () => {\r\n      const editBox = alertScript.editLabelNode.getComponent(EditBox);\r\n      const roomId = editBox.string;\r\n      if (roomId.length != 36) {\r\n        console.log(\"룸 정보 오류\");\r\n        return;\r\n      }\r\n      alertScript.buttonActive(false);\r\n      const roomDataResult = await self.loadData(roomId);\r\n      roomDataResult.roomData = JSON.parse(roomDataResult.roomData);\r\n      roomDataResult.decoArray = JSON.parse(roomDataResult.decoArray);\r\n      roomDataResult.objectArray = JSON.parse(roomDataResult.objectArray);\r\n      // set updated data\r\n      const objectDic = self.updateRoomDeco(roomDataResult);\r\n      self.updateImages(objectDic);\r\n      alertScript.removeAlert();\r\n    };\r\n  }\r\n  updateRoomDeco(roomDataResult) {\r\n    this.roomId = roomDataResult.roomData.roomId;\r\n    this.activeDeco = null;\r\n    this.decoDic = {};\r\n    const objectDic = {};\r\n    for (var i in roomDataResult.objectArray) {\r\n      const objectData = roomDataResult.objectArray[i];\r\n      const objectId = objectData.objectId;\r\n      objectData.spriteFrame = \"\";\r\n      objectData.imgFile = \"\";\r\n      objectData.shadowFrame = \"\";\r\n      objectData.shadowFile = \"\";\r\n      objectData.objectPlace = new Vec3(\r\n        objectData.objectPlace.x,\r\n        objectData.objectPlace.y,\r\n        objectData.objectPlace.z\r\n      );\r\n      objectData.objectPoint = new Vec3(\r\n        objectData.objectPoint.x,\r\n        objectData.objectPoint.y,\r\n        objectData.objectPoint.z\r\n      );\r\n      objectData.objectSize = new Vec3(\r\n        objectData.objectSize.x,\r\n        objectData.objectSize.y,\r\n        objectData.objectSize.z\r\n      );\r\n      objectDic[objectId] = objectData;\r\n    }\r\n    for (var i in roomDataResult.decoArray) {\r\n      const decoData = roomDataResult.decoArray[i] as Deco;\r\n      delete decoData[\"updatedTime\"];\r\n      const decoId = decoData.decoId;\r\n      decoData.label = \"오브젝트\" + String(i);\r\n      decoData.selectedDeco = 0;\r\n      decoData.decoPoint = new Vec3(\r\n        decoData.decoPoint.x,\r\n        decoData.decoPoint.y,\r\n        decoData.decoPoint.z\r\n      );\r\n      decoData.stackSize = new Vec3(\r\n        decoData.stackSize.x,\r\n        decoData.stackSize.y,\r\n        decoData.stackSize.z\r\n      );\r\n      for (var j in decoData.objectArray) {\r\n        const objectId = decoData.objectArray[j];\r\n        decoData.objectArray[j] = objectDic[objectId as any];\r\n      }\r\n      while (decoData.objectArray.length < 3) {\r\n        decoData.objectArray.push({\r\n          objectId: \"\",\r\n          objectIdx: Number(j) + 1,\r\n          decoId: decoData.decoId,\r\n          objectPoint: new Vec3(0, 0, 0),\r\n          objectSize: new Vec3(1, 1, 1),\r\n          objectPlace: new Vec3(0, 0, 0),\r\n          imgURL: \"\",\r\n          spriteFrame: \"\",\r\n          imgFile: \"\",\r\n          shadowFrame: \"\",\r\n          shadowFile: \"\",\r\n          buyType: \"00\",\r\n          cashPrice: 0,\r\n        });\r\n      }\r\n      const imgNode = instantiate(this.assetManager.prefabDic[\"ImageNode\"]);\r\n      const imgSprite = imgNode.getComponent(Sprite);\r\n      imgSprite.sizeMode = Sprite.SizeMode.RAW;\r\n      imgSprite.trim = true;\r\n      let nodeOrder = Object.keys(this.decoDic).length;\r\n      (this.roomNode.getComponent(\"RoomTemplate\") as RoomTemplate).addDecoNode(\r\n        imgNode,\r\n        nodeOrder,\r\n        decoData.placeType == \"00\"\r\n      );\r\n      decoData.node = imgNode;\r\n      // set deco position\r\n      // console.log(decoData, decoData.selectedDeco);\r\n      this.placeDeco(\r\n        imgNode,\r\n        decoData.decoPoint,\r\n        decoData.objectArray[decoData.selectedDeco].objectPoint,\r\n        decoData.objectArray[decoData.selectedDeco].objectSize,\r\n        decoData.anchorType\r\n      );\r\n\r\n      this.decoDic[decoId] = decoData;\r\n      if (!this.activeDeco) {\r\n        this.activeDeco = this.decoDic[decoId] as Deco;\r\n      }\r\n    }\r\n    // console.log(this.decoDic);\r\n    const decoMaster = this.decoMaster.getComponent(\"DecoMaster\") as DecoMaster;\r\n    decoMaster.resetDecoObject();\r\n    decoMaster.decoData = this.activeDeco;\r\n    const fileMaster = this.fileMaster.getComponent(\"FileMaster\") as FileMaster;\r\n    fileMaster.decoDic = this.decoDic;\r\n    fileMaster.updateFileMaster();\r\n    decoMaster.decoData = this.activeDeco;\r\n\r\n    return objectDic;\r\n  }\r\n  async updateImages(objectDic) {\r\n    const keys = Object.keys(objectDic);\r\n    for (var i in keys) {\r\n      const key = keys[i];\r\n      const obj = objectDic[key] as DecoObj;\r\n      const fileResult = (await this.assetManager.loadImgFromURL(\r\n        obj.imgURL\r\n      )) as any;\r\n      obj.spriteFrame = fileResult.spriteFrame;\r\n      obj.imgFile = fileResult.imgFile;\r\n\r\n      // (1) update deco master\r\n      if (\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectId ==\r\n        obj.objectId\r\n      ) {\r\n        const decoMaster = this.decoMaster.getComponent(\r\n          \"DecoMaster\"\r\n        ) as DecoMaster;\r\n        decoMaster.updateObjectImg();\r\n      }\r\n      // (2) update deco\r\n      const decoData = this.decoDic[obj.decoId];\r\n      if (\r\n        decoData.objectArray[decoData.selectedDeco].objectId == obj.objectId\r\n      ) {\r\n        decoData.node.getComponent(Sprite).spriteFrame = obj.spriteFrame;\r\n      }\r\n      // (3) add to filemaster\r\n      const fileMaster = this.fileMaster.getComponent(\r\n        \"FileMaster\"\r\n      ) as FileMaster;\r\n      fileMaster.addImgObj(fileResult, obj.objectIdx);\r\n      // filemaster, roomtemplate, decomaster;\r\n    }\r\n  }\r\n  async saveRoomDeco() {\r\n    // console.log(this.decoDic);\r\n    const modalLayer = this.setModalColor();\r\n    const alertPrefab = instantiate(this.assetManager.prefabDic[\"DecoAlert\"]);\r\n    modalLayer.addChild(alertPrefab);\r\n    const alertScript = alertPrefab.getComponent(DecoAlert);\r\n    alertScript.setTitleLabel(\"데코레이션 저장\");\r\n    alertScript.setMainLabel(\"방의 데코레이션을 서버에 정하시겠습니까?\");\r\n    var self = this;\r\n    alertScript.yesEvent = async () => {\r\n      alertScript.progress = true;\r\n      alertScript.setMainLabel(\"꾸미기 정보 업로드를 시작합니다.\");\r\n      alertScript.buttonActive(false);\r\n      const objList = [];\r\n      const decoList = [];\r\n      const roomDic = {\r\n        roomId: self.roomId,\r\n        docoArray: [],\r\n      };\r\n      ////////////////////\r\n      const decoKeys = Object.keys(self.decoDic);\r\n      for (var i in decoKeys) {\r\n        const decoKey = decoKeys[i];\r\n        const decoObjList = [];\r\n        for (var j in self.decoDic[decoKey].objectArray) {\r\n          const obj = self.decoDic[decoKey].objectArray[j];\r\n          if (obj.objectId == \"\") {\r\n            continue;\r\n          }\r\n          const copyObj = Object.assign({}, obj);\r\n          delete copyObj[\"spriteFrame\"];\r\n          delete copyObj[\"imgFile\"];\r\n          delete copyObj[\"shadowFrame\"];\r\n          delete copyObj[\"shadowFile\"];\r\n          copyObj.objectPlace = {\r\n            x: obj.objectPlace.x,\r\n            y: obj.objectPlace.y,\r\n            z: obj.objectPlace.z,\r\n          };\r\n          copyObj.objectPoint = {\r\n            x: obj.objectPoint.x,\r\n            y: obj.objectPoint.y,\r\n            z: obj.objectPoint.z,\r\n          };\r\n          copyObj.objectSize = {\r\n            x: obj.objectSize.x,\r\n            y: obj.objectSize.y,\r\n            z: obj.objectSize.z,\r\n          };\r\n          if (obj.imgURL == \"\") {\r\n            const result = await self.sendImage(obj.objectId, obj.imgFile);\r\n            if (result.result == \"success\") {\r\n              copyObj.imgURL = result.url;\r\n            } else {\r\n              console.log(\"img upload error\", result);\r\n              break;\r\n            }\r\n          }\r\n          objList.push(copyObj);\r\n          decoObjList.push(obj.objectId);\r\n          // send obj data to server\r\n          const objectResult = await self.sendData(\r\n            \"object_datas\",\r\n            copyObj.objectId,\r\n            copyObj\r\n          );\r\n          if (objectResult.data != \"success\") {\r\n            console.log(\"오브젝트 정보 업로드 실패 : \", copyObj.objectId);\r\n          }\r\n          // console.log(objectResult);\r\n        }\r\n        const copyDeco = Object.assign({}, self.decoDic[decoKey]) as Deco;\r\n        delete copyDeco[\"node\"];\r\n        delete copyDeco[\"label\"];\r\n        delete copyDeco[\"objectArray\"];\r\n        delete copyDeco[\"selectedDeco\"];\r\n\r\n        copyDeco.decoPoint = {\r\n          x: copyDeco.decoPoint.x,\r\n          y: copyDeco.decoPoint.y,\r\n          z: copyDeco.decoPoint.z,\r\n        };\r\n        copyDeco.stackSize = {\r\n          x: copyDeco.stackSize.x,\r\n          y: copyDeco.stackSize.y,\r\n          z: copyDeco.stackSize.z,\r\n        };\r\n        copyDeco.objectArray = decoObjList;\r\n        decoList.push(copyDeco);\r\n        roomDic.docoArray.push(self.decoDic[decoKey].decoId);\r\n        // send deco data to server\r\n        const decoResult = await self.sendData(\r\n          \"deco_datas\",\r\n          copyDeco.decoId,\r\n          copyDeco\r\n        );\r\n        if (decoResult.data != \"success\") {\r\n          console.log(\"꾸미기 정보 업로드 실패 : \", copyDeco.decoId);\r\n        }\r\n        // console.log(decoResult);\r\n      }\r\n      // send room data to server\r\n      const roomResult = await self.sendData(\r\n        \"room_datas\",\r\n        roomDic.roomId,\r\n        roomDic\r\n      );\r\n      if (roomResult.data != \"success\") {\r\n        console.log(\"방 정보 업로드 실패 : \", roomDic.roomId);\r\n      }\r\n      alertScript.setMainLabel(\r\n        \"꾸미기 정보 업로드가 완료되었습니다. \" + roomDic.roomId\r\n      );\r\n      console.log(roomDic.roomId);\r\n      alertScript.noButtonActive(true);\r\n    };\r\n  }\r\n}\r\n"]}