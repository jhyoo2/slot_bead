{"version":3,"sources":["file:///Users/david/Desktop/David/cocos/slot_bead/assets/scripts/Scenes/PinballScene.ts"],"names":["_decorator","Node","PhysicsSystem2D","Vec2","Vec3","RigidBody2D","Prefab","instantiate","tween","UITransform","Size","UIOpacity","game","BaseScene","BeadNode","ObstacleNode","TileNode","ccclass","property","PinballScene","Date","onLoad","instance","enable","gravity","frameRate","setFrameRate","makeTile","i","j","tileNode","tilePrefab","addComponent","opacity","tileLayer","addChild","getComponent","setContentSize","setPosition","tileArray","push","tileScript","row","column","occupied","alocateMonster","monsterArray","Math","floor","random","idx","getPosition","monsterScript","rollButtonClicked","console","log","myForce","gameStart","beadArray","beadStart","coinNum","roolStart","myTime","length","myBead","removeFromParent","destroy","splice","vecArray","beadNode","beadPrefab","nodeLayer","addRandomForce","myIdx","Number","onTouchStart","event","bidRigid","applyForce","update","dt","totalForce","sqrt","pow","linearVelocity","x","y","realStart","getTime","timeDiff","diminishVelocity","addGold","gold","moveMonster","monster","tryTime","direction","to","position","start"],"mappings":"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","sourcesContent":["import {\r\n  _decorator,\r\n  size,\r\n  director,\r\n  Node,\r\n  PhysicsSystem2D,\r\n  Vec2,\r\n  PHYSICS_2D_PTM_RATIO,\r\n  EPhysics2DDrawFlags,\r\n  RigidBody,\r\n  Vec3,\r\n  RigidBody2D,\r\n  Prefab,\r\n  instantiate,\r\n  tween,\r\n  SpriteAtlas,\r\n  Sprite,\r\n  SpriteFrame,\r\n  UITransform,\r\n  Size,\r\n  UIOpacity,\r\n  ObjectCurve,\r\n  game,\r\n} from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\n\r\nimport BaseScene from \"../BaseObject/BaseScene\";\r\nimport AssetManager from \"../DataManager/AssetManager\";\r\nimport BaseRoom from \"../Prefabs/Room/BaseRoom\";\r\nimport { BeadNode } from \"./BeadNode\";\r\nimport { ObstacleNode } from \"./ObstacleNode\";\r\nimport { TileNode } from \"./TileNode\";\r\n\r\n@ccclass(\"PinballScene\")\r\nexport class PinballScene extends BaseScene {\r\n  assetManager: AssetManager = null;\r\n\r\n  @property(Node)\r\n  tileLayer: Node | null = null;\r\n\r\n  @property(Node)\r\n  nodeLayer: Node | null = null;\r\n\r\n  @property(Prefab)\r\n  beadPrefab: Prefab | null = null;\r\n\r\n  @property(Prefab)\r\n  tilePrefab: Prefab | null = null;\r\n\r\n  @property(Node)\r\n  beadArray: Node[] = [];\r\n\r\n  @property(Node)\r\n  monsterArray: Node[] = [];\r\n\r\n  myForce = 0;\r\n  myTime: Date = new Date();\r\n  roolStart = false;\r\n  realStart = false;\r\n  coinNum = 0;\r\n  tileArray = [];\r\n  // -520\r\n\r\n  async onLoad() {\r\n    super.onLoad();\r\n    PhysicsSystem2D.instance.enable = true;\r\n    PhysicsSystem2D.instance.gravity = new Vec2(0, 0);\r\n    game.frameRate = 60.0;\r\n    game.setFrameRate(60.0);\r\n    // PhysicsSystem2D.instance.gravity = new Vec2(0, -20 * PHYSICS_2D_PTM_RATIO);\r\n    // PhysicsSystem2D.instance.debugDrawFlags =\r\n    //   EPhysics2DDrawFlags.Aabb |\r\n    //   EPhysics2DDrawFlags.Pair |\r\n    //   EPhysics2DDrawFlags.CenterOfMass |\r\n    //   EPhysics2DDrawFlags.Joint |\r\n    //   EPhysics2DDrawFlags.Shape;\r\n\r\n    // this.assetManager = AssetManager.getInstance();\r\n    // const assetResult = await this.assetManager.loadAssets();\r\n\r\n    // this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this, true);\r\n    this.makeTile();\r\n    // this.alocateMonster();\r\n  }\r\n  makeTile() {\r\n    for (var i = 0; i < 12; i++) {\r\n      for (var j = 0; j < 8; j++) {\r\n        const tileNode = instantiate(this.tilePrefab);\r\n        tileNode.addComponent(UIOpacity).opacity = 50 + 100 * ((i + j) % 2);\r\n        this.tileLayer.addChild(tileNode);\r\n        tileNode.getComponent(UITransform).setContentSize(new Size(110, 114));\r\n        tileNode.setPosition(\r\n          new Vec3(-440 + 110 * 0.5 + 110 * j, -750 + 114 * 0.5 + 114 * i)\r\n        );\r\n        this.tileArray.push(tileNode);\r\n\r\n        const tileScript = tileNode.getComponent(TileNode);\r\n        tileScript.row = i;\r\n        tileScript.column = j;\r\n        tileScript.occupied = false;\r\n      }\r\n    }\r\n  }\r\n  alocateMonster() {\r\n    for (let i in this.monsterArray) {\r\n      while (true) {\r\n        const row = Math.floor(Math.random() * 6) + 5;\r\n        const column = Math.floor(Math.random() * 8);\r\n        const idx = row * 8 + column;\r\n        const tileScript = this.tileArray[idx].getComponent(TileNode);\r\n        if (tileScript.occupied) {\r\n          continue;\r\n        }\r\n        tileScript.occupied = true;\r\n        this.monsterArray[i].setPosition(this.tileArray[idx].getPosition());\r\n        const monsterScript = this.monsterArray[i].getComponent(ObstacleNode);\r\n        monsterScript.row = row;\r\n        monsterScript.column = column;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  rollButtonClicked() {\r\n    console.log(\"roll\", this.myForce);\r\n    let gameStart = true;\r\n    for (var i in this.beadArray) {\r\n      if (this.beadArray[i].getComponent(BeadNode).beadStart) {\r\n        gameStart = false;\r\n      }\r\n    }\r\n\r\n    if (gameStart) {\r\n      this.coinNum = 0;\r\n      this.roolStart = true;\r\n      this.myTime = new Date();\r\n      if (this.beadArray.length > 0) {\r\n        while (this.beadArray.length > 0) {\r\n          const myBead = this.beadArray[0];\r\n          myBead.removeFromParent();\r\n          myBead.destroy();\r\n          this.beadArray.splice(0, 1);\r\n        }\r\n      }\r\n      const vecArray = [\r\n        new Vec3(-122, -480, 0),\r\n        new Vec3(0, -420, 0),\r\n        new Vec3(122, -480, 0),\r\n      ];\r\n      for (let i = 0; i < 3; i++) {\r\n        const beadNode = instantiate(this.beadPrefab);\r\n        this.nodeLayer.addChild(beadNode);\r\n        beadNode.setPosition(vecArray[i]);\r\n        this.beadArray.push(beadNode);\r\n        beadNode.getComponent(BeadNode).addRandomForce();\r\n        beadNode.getComponent(BeadNode).myIdx = Number(i);\r\n      }\r\n    }\r\n  }\r\n\r\n  onTouchStart(event) {\r\n    // console.log(event);\r\n    for (var i in this.beadArray) {\r\n      const myBead = this.beadArray[i];\r\n      const bidRigid = myBead.getComponent(RigidBody2D);\r\n      bidRigid.applyForce(\r\n        new Vec2(50000 + 5000 * Number(i), 20000 + 500 * Number(i)),\r\n        new Vec2(200, 20),\r\n        true\r\n      );\r\n    }\r\n    // bidRigid.applyForceToCenter(new Vec2(20000, 2000), true);\r\n  }\r\n  update(dt) {\r\n    let totalForce = 0;\r\n    for (var i in this.beadArray) {\r\n      const myBead = this.beadArray[i];\r\n      const bidRigid = myBead.getComponent(RigidBody2D);\r\n      const myForce = Math.sqrt(\r\n        Math.pow(bidRigid.linearVelocity.x, 2) +\r\n          Math.pow(bidRigid.linearVelocity.y, 2)\r\n      );\r\n      totalForce += myForce;\r\n    }\r\n    this.myForce = totalForce;\r\n    if (this.roolStart && totalForce > 0 && !this.realStart) {\r\n      this.realStart = true;\r\n    }\r\n    if (this.realStart) {\r\n      if (totalForce == 0) {\r\n        this.roolStart = false;\r\n        this.realStart = false;\r\n        // this.moveMonster();\r\n        console.log(\r\n          \"gold : \" + this.coinNum,\r\n          \"time : \" + (new Date().getTime() - this.myTime.getTime()) / 1000\r\n        );\r\n      }\r\n    }\r\n\r\n    const timeDiff = (new Date().getTime() - this.myTime.getTime()) / 1000;\r\n    if (timeDiff >= 3) {\r\n      for (var i in this.beadArray) {\r\n        const myBead = this.beadArray[i];\r\n        myBead.getComponent(BeadNode).diminishVelocity(0.95);\r\n      }\r\n    } else if (timeDiff >= 2) {\r\n      for (var i in this.beadArray) {\r\n        const myBead = this.beadArray[i];\r\n        myBead.getComponent(BeadNode).diminishVelocity(0.975);\r\n      }\r\n    }\r\n  }\r\n\r\n  addGold(gold) {\r\n    this.coinNum += gold;\r\n  }\r\n\r\n  moveMonster() {\r\n    for (let i in this.monsterArray) {\r\n      const monster = this.monsterArray[i];\r\n      const monsterScript = this.monsterArray[i].getComponent(ObstacleNode);\r\n      let tryTime = 0;\r\n      while (tryTime < 100) {\r\n        tryTime++;\r\n        const direction = Math.floor(Math.random() * 4);\r\n        let row = 0;\r\n        let column = 0;\r\n        switch (direction) {\r\n          case 0:\r\n            row = -1;\r\n            break;\r\n          case 1:\r\n            row = 1;\r\n            break;\r\n          case 2:\r\n            column = -1;\r\n            break;\r\n          case 3:\r\n            column = 1;\r\n            break;\r\n        }\r\n        row += monsterScript.row;\r\n        if (row < 5 || row >= 11) {\r\n          continue;\r\n        }\r\n        column += monsterScript.column;\r\n        if (column < 0 || column >= 8) {\r\n          continue;\r\n        }\r\n        const idx = row * 8 + column;\r\n        // console.log(monsterScript.row, monsterScript.column, row, column, idx);\r\n        const tileScript = this.tileArray[idx].getComponent(TileNode);\r\n        if (tileScript.occupied) {\r\n          continue;\r\n        }\r\n        this.tileArray[\r\n          monsterScript.row * 8 + monsterScript.column\r\n        ].getComponent(TileNode).occupied = false;\r\n        tileScript.occupied = true;\r\n        monsterScript.row = row;\r\n        monsterScript.column = column;\r\n        tween(monster)\r\n          .to(0.2, { position: this.tileArray[idx].getPosition() })\r\n          .start();\r\n        tryTime = 0;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}