{"version":3,"sources":["file:///Users/david/Desktop/David/cocos/slot_bead/assets/scripts/Scenes/PinballScene.ts"],"names":["_decorator","Node","PhysicsSystem2D","Vec2","Vec3","RigidBody2D","Prefab","instantiate","tween","UITransform","Size","UIOpacity","Label","BaseScene","BeadNode","ObstacleNode","TileNode","ccclass","property","PinballScene","Date","onLoad","instance","enable","gravity","makeTile","alocateMonster","i","j","tileNode","tilePrefab","addComponent","opacity","tileLayer","addChild","getComponent","setContentSize","setPosition","tileArray","push","tileScript","row","column","occupied","monsterArray","Math","floor","random","idx","getPosition","monsterScript","rollButtonClicked","console","log","myForce","gameStart","beadArray","beadStart","coinNum","roolStart","myTime","length","myBead","removeFromParent","destroy","splice","myScale","pow","superBet","beadNode","beadPrefab","nodeLayer","setScale","addRandomForce","activateBead","onTouchStart","event","bidRigid","applyForce","Number","update","dt","totalForce","sqrt","linearVelocity","x","y","realStart","gameEnd","moveMonster","getTime","timeDiff","diminishVelocity","addGold","gold","monster","tryTime","direction","to","position","start","superBetClicked","superBetButton","getChildByName","string","String"],"mappings":"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","sourcesContent":["import {\r\n  _decorator,\r\n  size,\r\n  director,\r\n  Node,\r\n  PhysicsSystem2D,\r\n  Vec2,\r\n  PHYSICS_2D_PTM_RATIO,\r\n  EPhysics2DDrawFlags,\r\n  RigidBody,\r\n  Vec3,\r\n  RigidBody2D,\r\n  Prefab,\r\n  instantiate,\r\n  tween,\r\n  SpriteAtlas,\r\n  Sprite,\r\n  SpriteFrame,\r\n  UITransform,\r\n  Size,\r\n  UIOpacity,\r\n  ObjectCurve,\r\n  Label,\r\n} from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\n\r\nimport BaseScene from \"../BaseObject/BaseScene\";\r\nimport AssetManager from \"../DataManager/AssetManager\";\r\nimport BaseRoom from \"../Prefabs/Room/BaseRoom\";\r\nimport { BeadNode } from \"./BeadNode\";\r\nimport { ObstacleNode } from \"./ObstacleNode\";\r\nimport { TileNode } from \"./TileNode\";\r\n\r\n@ccclass(\"PinballScene\")\r\nexport class PinballScene extends BaseScene {\r\n  assetManager: AssetManager = null;\r\n\r\n  @property(Node)\r\n  tileLayer: Node | null = null;\r\n\r\n  @property(Node)\r\n  nodeLayer: Node | null = null;\r\n\r\n  @property(Prefab)\r\n  beadPrefab: Prefab | null = null;\r\n\r\n  @property(Prefab)\r\n  tilePrefab: Prefab | null = null;\r\n\r\n  @property(Node)\r\n  beadArray: Node[] = [];\r\n\r\n  @property(Node)\r\n  monsterArray: Node[] = [];\r\n\r\n  @property(Node)\r\n  superBetButton: Node | null = null;\r\n\r\n  myForce = 0;\r\n  myTime: Date = new Date();\r\n  roolStart = false;\r\n  realStart = false;\r\n  coinNum = 0;\r\n  tileArray = [];\r\n  // -520\r\n  superBet = 1;\r\n\r\n  async onLoad() {\r\n    super.onLoad();\r\n    PhysicsSystem2D.instance.enable = true;\r\n    PhysicsSystem2D.instance.gravity = new Vec2(0, 0);\r\n    // PhysicsSystem2D.instance.gravity = new Vec2(0, -20 * PHYSICS_2D_PTM_RATIO);\r\n    // PhysicsSystem2D.instance.debugDrawFlags =\r\n    //   EPhysics2DDrawFlags.Aabb |\r\n    //   EPhysics2DDrawFlags.Pair |\r\n    //   EPhysics2DDrawFlags.CenterOfMass |\r\n    //   EPhysics2DDrawFlags.Joint |\r\n    //   EPhysics2DDrawFlags.Shape;\r\n\r\n    // this.assetManager = AssetManager.getInstance();\r\n    // const assetResult = await this.assetManager.loadAssets();\r\n\r\n    // this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this, true);\r\n    this.makeTile();\r\n    this.alocateMonster();\r\n  }\r\n  makeTile() {\r\n    for (var i = 0; i < 12; i++) {\r\n      for (var j = 0; j < 8; j++) {\r\n        const tileNode = instantiate(this.tilePrefab);\r\n        tileNode.addComponent(UIOpacity).opacity = 50 + 100 * ((i + j) % 2);\r\n        this.tileLayer.addChild(tileNode);\r\n        tileNode.getComponent(UITransform).setContentSize(new Size(110, 114));\r\n        tileNode.setPosition(\r\n          new Vec3(-440 + 110 * 0.5 + 110 * j, -750 + 114 * 0.5 + 114 * i)\r\n        );\r\n        this.tileArray.push(tileNode);\r\n\r\n        const tileScript = tileNode.getComponent(TileNode);\r\n        tileScript.row = i;\r\n        tileScript.column = j;\r\n        tileScript.occupied = false;\r\n      }\r\n    }\r\n  }\r\n  alocateMonster() {\r\n    for (let i in this.monsterArray) {\r\n      while (true) {\r\n        const row = Math.floor(Math.random() * 5) + 3;\r\n        const column = Math.floor(Math.random() * 8);\r\n        const idx = row * 8 + column;\r\n        const tileScript = this.tileArray[idx].getComponent(TileNode);\r\n        if (tileScript.occupied) {\r\n          continue;\r\n        }\r\n        tileScript.occupied = true;\r\n        this.monsterArray[i].setPosition(this.tileArray[idx].getPosition());\r\n        const monsterScript = this.monsterArray[i].getComponent(ObstacleNode);\r\n        monsterScript.row = row;\r\n        monsterScript.column = column;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  rollButtonClicked() {\r\n    console.log(\"roll\", this.myForce);\r\n    let gameStart = true;\r\n    for (var i in this.beadArray) {\r\n      if (this.beadArray[i].getComponent(BeadNode).beadStart) {\r\n        gameStart = false;\r\n      }\r\n    }\r\n\r\n    if (gameStart) {\r\n      this.coinNum = 0;\r\n      this.roolStart = true;\r\n      this.myTime = new Date();\r\n      if (this.beadArray.length > 0) {\r\n        while (this.beadArray.length > 0) {\r\n          const myBead = this.beadArray[0];\r\n          myBead.removeFromParent();\r\n          myBead.destroy();\r\n          this.beadArray.splice(0, 1);\r\n        }\r\n      }\r\n      const myScale = 0.45 * Math.pow(0.95, this.superBet - 1);\r\n      for (let i = 0; i < this.superBet; i++) {\r\n        const beadNode = instantiate(this.beadPrefab);\r\n        this.nodeLayer.addChild(beadNode);\r\n        beadNode.setScale(new Vec3(myScale, myScale, myScale));\r\n        beadNode.setPosition(new Vec3(-162 + Math.random() * 324, -620, 0));\r\n        this.beadArray.push(beadNode);\r\n        beadNode.getComponent(BeadNode).addRandomForce();\r\n        beadNode.getComponent(BeadNode).activateBead();\r\n      }\r\n    }\r\n  }\r\n\r\n  onTouchStart(event) {\r\n    // console.log(event);\r\n    for (var i in this.beadArray) {\r\n      const myBead = this.beadArray[i];\r\n      const bidRigid = myBead.getComponent(RigidBody2D);\r\n      bidRigid.applyForce(\r\n        new Vec2(50000 + 5000 * Number(i), 20000 + 500 * Number(i)),\r\n        new Vec2(200, 20),\r\n        true\r\n      );\r\n    }\r\n    // bidRigid.applyForceToCenter(new Vec2(20000, 2000), true);\r\n  }\r\n  update(dt) {\r\n    let totalForce = 0;\r\n    for (var i in this.beadArray) {\r\n      const myBead = this.beadArray[i];\r\n      const bidRigid = myBead.getComponent(RigidBody2D);\r\n      const myForce = Math.sqrt(\r\n        Math.pow(bidRigid.linearVelocity.x, 2) +\r\n          Math.pow(bidRigid.linearVelocity.y, 2)\r\n      );\r\n      totalForce += myForce;\r\n    }\r\n    this.myForce = totalForce;\r\n    if (this.roolStart && totalForce > 0 && !this.realStart) {\r\n      this.realStart = true;\r\n      this.myTime = new Date();\r\n    }\r\n\r\n    let gameEnd = true;\r\n    for (var i in this.beadArray) {\r\n      if (this.beadArray[i].getComponent(BeadNode).beadStart) {\r\n        gameEnd = false;\r\n      }\r\n    }\r\n\r\n    if (gameEnd && this.roolStart) {\r\n      this.roolStart = false;\r\n      this.realStart = false;\r\n      this.moveMonster();\r\n      console.log(\r\n        \"gold : \" + this.coinNum,\r\n        \"time : \" + (new Date().getTime() - this.myTime.getTime()) / 1000\r\n      );\r\n    }\r\n    const timeDiff = (new Date().getTime() - this.myTime.getTime()) / 1000;\r\n    if (timeDiff >= 3) {\r\n      for (var i in this.beadArray) {\r\n        const myBead = this.beadArray[i];\r\n        myBead.getComponent(BeadNode).diminishVelocity(0.95);\r\n      }\r\n    } else if (timeDiff >= 2) {\r\n      for (var i in this.beadArray) {\r\n        const myBead = this.beadArray[i];\r\n        myBead.getComponent(BeadNode).diminishVelocity(0.975);\r\n      }\r\n    }\r\n  }\r\n\r\n  addGold(gold) {\r\n    this.coinNum += gold;\r\n  }\r\n\r\n  moveMonster() {\r\n    for (let i in this.monsterArray) {\r\n      const monster = this.monsterArray[i];\r\n      const monsterScript = this.monsterArray[i].getComponent(ObstacleNode);\r\n      let tryTime = 0;\r\n      while (tryTime < 100) {\r\n        tryTime++;\r\n        const direction = Math.floor(Math.random() * 4);\r\n        let row = 0;\r\n        let column = 0;\r\n        switch (direction) {\r\n          case 0:\r\n            row = -1;\r\n            break;\r\n          case 1:\r\n            row = 1;\r\n            break;\r\n          case 2:\r\n            column = -1;\r\n            break;\r\n          case 3:\r\n            column = 1;\r\n            break;\r\n        }\r\n        row += monsterScript.row;\r\n        if (row < 3 || row >= 8) {\r\n          continue;\r\n        }\r\n        column += monsterScript.column;\r\n        if (column < 0 || column >= 8) {\r\n          continue;\r\n        }\r\n        const idx = row * 8 + column;\r\n        // console.log(monsterScript.row, monsterScript.column, row, column, idx);\r\n        const tileScript = this.tileArray[idx].getComponent(TileNode);\r\n        if (tileScript.occupied) {\r\n          continue;\r\n        }\r\n        this.tileArray[\r\n          monsterScript.row * 8 + monsterScript.column\r\n        ].getComponent(TileNode).occupied = false;\r\n        tileScript.occupied = true;\r\n        monsterScript.row = row;\r\n        monsterScript.column = column;\r\n        tween(monster)\r\n          .to(0.2, { position: this.tileArray[idx].getPosition() })\r\n          .start();\r\n        tryTime = 0;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  superBetClicked() {\r\n    switch (this.superBet) {\r\n      case 1:\r\n        this.superBet = 3;\r\n        break;\r\n      case 3:\r\n        this.superBet = 5;\r\n        break;\r\n      case 5:\r\n        this.superBet = 10;\r\n        break;\r\n      case 10:\r\n        this.superBet = 1;\r\n        break;\r\n    }\r\n    this.superBetButton.getChildByName(\"Label\").getComponent(Label).string =\r\n      String(this.superBet);\r\n  }\r\n}\r\n"]}