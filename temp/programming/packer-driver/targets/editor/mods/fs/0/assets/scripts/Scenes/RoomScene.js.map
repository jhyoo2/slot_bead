{"version":3,"sources":["file:///Users/david/Desktop/David/cocos/slot_temp1/assets/scripts/Scenes/RoomScene.ts"],"names":["_decorator","Node","instantiate","Vec3","ImageAsset","Sprite","SpriteFrame","Texture2D","UITransform","UIOpacityComponent","EditBox","BaseScene","AssetManager","uuidv4","DecoMaster","DecoAlert","ccclass","property","RoomScene","onLoad","setWideResolution","assetManager","getInstance","assetResult","loadAssets","roomNode","prefabDic","scale","node","insertChild","roomScript","getComponent","showBlock","decoMaster","setPosition","winSize","width","height","sceneScript","addChild","fileMaster","fileScript","decoDic","on","EventType","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","showGrid","isChecked","addDecoData","decoObject","tag","activeDeco","decoData","initDefaultDeco","decoId","placeType","keys","Object","zOrder","i","label","String","length","imgNode","getImgNode","img","imgSprite","sizeMode","SizeMode","RAW","trim","spriteFrame","console","log","objectArray","push","objectId","id","objectIdx","objectPoint","objectSize","objectPlace","imgURL","imgFile","file","shadowFrame","shadowFile","buyType","cashPrice","j","Number","labelArray","imgSize","contentSize","xSize","Math","min","ceil","ySize","decoPoint","floor","zSize","TOUCH_START","event","propagationStopped","onDecoSelected","nodeOrder","addDecoNode","updateDecoPoint","placeDeco","selectedDeco","anchorType","resetDecoObject","updateFileMaster","imgResult","imgAsset","tex","image","texture","decoType","opacity","stackable","stackSize","defaultObjectId","eraseDeco","removeFromParent","setDecoData","kind","obj","setObjectData","getAnchorPoint","updateDecoPlace","point","size","anchor","x","max","y","z","getBlockPosition","showDecoBlock","checkDecoData","onFileSelected","fileData","location","touch","getUILocation","zeroPos","sizePos","targetList","getBlockTarget","targetBlock","baseDis","block","distance","sqrt","pow","getWorldPosition","blockScript","blockPosition","simulate","setSelectedDeco","idx","assetDic","replaceDeco","imgPos","imgDistance","shadowPos","shadowNode","shadowDistance","replaceObjImage","replaceImg","imgObject","sendImage","fileName","r","fetch","method","headers","body","JSON","stringify","parse","text","sendData","collection","doc","data","loadData","roomId","roomDecoSelected","selectedIdx","decoKeys","key","resetRoomDeco","modalLayer","setModalColor","alertPrefab","alertScript","setTitleLabel","setMainLabel","self","yesEvent","updateObjectImg","removeObjDic","removeAlert","loadRoomDeco","editNodeActive","editBox","editLabelNode","string","buttonActive","roomDataResult","roomData","decoArray","objectDic","updateRoomDeco","updateImages","objectData","fileResult","loadImgFromURL","addImgObj","saveRoomDeco","progress","objList","decoList","roomDic","docoArray","decoKey","decoObjList","copyObj","assign","result","url","objectResult","copyDeco","decoResult","roomResult","noButtonActive"],"mappings":"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","sourcesContent":["import {\r\n  _decorator,\r\n  Node,\r\n  instantiate,\r\n  Vec3,\r\n  ImageAsset,\r\n  Sprite,\r\n  SpriteFrame,\r\n  Texture2D,\r\n  UITransform,\r\n  Size,\r\n  UIOpacityComponent,\r\n  JsonAsset,\r\n  EditBox,\r\n  UITransformComponent,\r\n} from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\n\r\nimport BaseScene from \"../BaseObject/BaseScene\";\r\nimport AssetManager from \"../DataManager/AssetManager\";\r\nimport RoomTemplate from \"../Prefabs/Room/RoomTemplate\";\r\nimport { uuidv4 } from \"../Common/Module\";\r\nimport DecoMaster from \"../Prefabs/Deco/DecoMaster\";\r\nimport FileMaster from \"../Prefabs/Deco/FileMaster\";\r\nimport RoomBlock from \"../Prefabs/Room/RoomBlock\";\r\n\r\nimport {\r\n  Deco,\r\n  DecoObj,\r\n  FileObject,\r\n  DecoType,\r\n  PlaceType,\r\n  AnchorType,\r\n} from \"../Prefabs/Deco/DecoTypes\";\r\nimport DecoAlert from \"../Prefabs/Deco/DecoAlert\";\r\n\r\n@ccclass(\"RoomScene\")\r\nexport class RoomScene extends BaseScene {\r\n  assetManager: AssetManager = null;\r\n\r\n  // (1) room node\r\n  roomNode: Node = null;\r\n  roomId = uuidv4();\r\n  // roomTemplate: RoomTemplate = null;\r\n\r\n  // (5) deco data\r\n  decoMaster: Node = null;\r\n  fileMaster: Node = null;\r\n  activeDeco: Deco = null;\r\n  // activeObject = 0;\r\n  selectedDeco: Node = null;\r\n  decoDic: { [name: string]: Deco } = {};\r\n  selectedIdx = 0;\r\n\r\n  async onLoad() {\r\n    super.setWideResolution();\r\n    this.assetManager = AssetManager.getInstance();\r\n    const assetResult = await this.assetManager.loadAssets();\r\n    const roomNode = instantiate(this.assetManager.prefabDic[\"RoomTemplate\"]);\r\n    // roomNode.setPosition(new Vec3(0, 250, 0));\r\n    roomNode.scale = new Vec3(1.5, 1.5, 1.5);\r\n    // roomNode.scale = new Vec3(1.25, 1.25, 1.25);\r\n    this.node.insertChild(roomNode, 10);\r\n    this.roomNode = roomNode;\r\n    const roomScript = this.roomNode.getComponent(\r\n      \"RoomTemplate\"\r\n    ) as RoomTemplate;\r\n    roomScript.showBlock(false);\r\n\r\n    // set deco master\r\n    const decoMaster = instantiate(this.assetManager.prefabDic[\"DecoMaster\"]);\r\n    decoMaster.setPosition(\r\n      new Vec3(this.winSize.width / 2 - 370, this.winSize.height / 2, 1)\r\n    );\r\n    decoMaster.getComponent(\"DecoMaster\").sceneScript = this;\r\n    this.node.addChild(decoMaster);\r\n    this.decoMaster = decoMaster;\r\n\r\n    // set file master\r\n    const fileMaster = instantiate(this.assetManager.prefabDic[\"FileMaster\"]);\r\n    fileMaster.setPosition(\r\n      new Vec3(-this.winSize.width / 2 + 370, this.winSize.height / 2, 1)\r\n    );\r\n    this.node.addChild(fileMaster);\r\n    const fileScript = fileMaster.getComponent(\"FileMaster\") as FileMaster;\r\n    fileScript.sceneScript = this;\r\n    fileScript.decoDic = this.decoDic;\r\n    this.fileMaster = fileMaster;\r\n\r\n    // add touchEvent\r\n    this.node.on(Node.EventType.TOUCH_MOVE, this.onTouchMove, this, true);\r\n    this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this, true);\r\n    this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this, true);\r\n  }\r\n  showGrid(node) {\r\n    const roomScript = this.roomNode.getComponent(\r\n      \"RoomTemplate\"\r\n    ) as RoomTemplate;\r\n    roomScript.showBlock(node.isChecked);\r\n  }\r\n  /////// ////////////////////////////\r\n  // (1) select deco\r\n  addDecoData(decoObject: FileObject, tag) {\r\n    if (this.activeDeco) {\r\n      this.activeDeco = null;\r\n    }\r\n    // add deco data\r\n    const decoData = this.initDefaultDeco(decoObject);\r\n    this.decoDic[decoData.decoId] = decoData;\r\n    this.activeDeco = decoData;\r\n    this.activeDeco.placeType = tag;\r\n    const keys = Object.keys(this.decoDic);\r\n    let zOrder = 0;\r\n    for (var i in keys) {\r\n      if (this.decoDic[keys[i]].placeType == tag) {\r\n        zOrder++;\r\n      }\r\n    }\r\n    this.activeDeco.label = \"오브젝트\" + String(keys.length);\r\n    this.activeDeco.zOrder = zOrder;\r\n\r\n    // add deco image\r\n    const imgNode = this.getImgNode(decoObject.img);\r\n    const imgSprite = imgNode.getComponent(Sprite);\r\n    imgSprite.sizeMode = Sprite.SizeMode.RAW;\r\n    imgSprite.trim = true;\r\n    imgSprite.spriteFrame = imgSprite.spriteFrame;\r\n    console.log(imgNode);\r\n\r\n    this.activeDeco.objectArray.push({\r\n      objectId: decoObject.id,\r\n      objectIdx: 0,\r\n      decoId: decoData.decoId,\r\n      objectPoint: new Vec3(0, 0, 0),\r\n      objectSize: new Vec3(1, 1, 1),\r\n      objectPlace: new Vec3(0, 0, 0),\r\n      imgURL: \"\",\r\n      spriteFrame: imgSprite.spriteFrame,\r\n      imgFile: decoObject.file,\r\n      shadowFrame: \"\",\r\n      shadowFile: \"\",\r\n      buyType: \"00\",\r\n      cashPrice: 0,\r\n    });\r\n    for (var j = 0; j < 2; j++) {\r\n      this.activeDeco.objectArray.push({\r\n        objectId: \"\",\r\n        objectIdx: Number(j) + 1,\r\n        decoId: decoData.decoId,\r\n        objectPoint: new Vec3(0, 0, 0),\r\n        objectSize: new Vec3(1, 1, 1),\r\n        objectPlace: new Vec3(0, 0, 0),\r\n        imgURL: \"\",\r\n        spriteFrame: \"\",\r\n        imgFile: \"\",\r\n        shadowFrame: \"\",\r\n        shadowFile: \"\",\r\n        buyType: \"00\",\r\n        cashPrice: 0,\r\n      });\r\n    }\r\n    const labelArray = [\"전체(0)\", \"바닥(0)\", \"왼쪽 벽(0)\", \"오른쪽 벽(0)\"];\r\n    const imgSize = (imgNode.getComponent(UITransform) as UITransform)\r\n      .contentSize;\r\n    if (tag == \"01\") {\r\n      const xSize = Math.min(18, Math.ceil(imgSize.width / (140 / 3)));\r\n      const ySize = Math.min(18, Math.ceil(imgSize.height / (40 / 3)));\r\n      this.activeDeco.objectArray[0].objectSize = new Vec3(xSize, ySize, 0);\r\n      this.activeDeco.decoPoint = new Vec3(\r\n        9 - Math.floor(xSize / 2),\r\n        9 - Math.floor(ySize / 2),\r\n        0\r\n      );\r\n    } else if (tag == \"02\") {\r\n      const ySize = Math.min(18, Math.ceil(imgSize.width / (70 / 3)));\r\n      const zSize = Math.min(18, Math.ceil(imgSize.height / (85 / 3)));\r\n      this.activeDeco.objectArray[0].objectSize = new Vec3(0, ySize, zSize);\r\n      this.activeDeco.decoPoint = new Vec3(\r\n        0,\r\n        9 - Math.floor(ySize / 2),\r\n        9 - Math.floor(zSize / 2)\r\n      );\r\n    } else if (tag == \"03\") {\r\n      const xSize = Math.min(18, Math.ceil(imgSize.width / (70 / 3)));\r\n      const zSize = Math.min(18, Math.ceil(imgSize.height / (85 / 3)));\r\n      this.activeDeco.objectArray[0].objectSize = new Vec3(xSize, 0, zSize);\r\n      this.activeDeco.decoPoint = new Vec3(\r\n        9 - Math.floor(xSize / 2),\r\n        17,\r\n        9 - Math.floor(zSize / 2)\r\n      );\r\n    }\r\n    // console.log(this.activeDeco.objectArray[0].objectSize);\r\n    // console.log(this.activeDeco.decoPoint);\r\n\r\n    if (decoData.placeType != \"00\") {\r\n      imgNode.on(\r\n        Node.EventType.TOUCH_START,\r\n        (event) => {\r\n          event.propagationStopped = true;\r\n          this.onDecoSelected(decoData);\r\n        },\r\n        this\r\n      );\r\n    }\r\n    let nodeOrder = Object.keys(this.decoDic).length;\r\n    // if (tag == \"00\") {\r\n    //   nodeOrder = 99;\r\n    // }\r\n    (this.roomNode.getComponent(\"RoomTemplate\") as RoomTemplate).addDecoNode(\r\n      imgNode,\r\n      nodeOrder,\r\n      tag == \"00\"\r\n    );\r\n    this.activeDeco.node = imgNode;\r\n\r\n    // set deco position\r\n    this.updateDecoPoint();\r\n    this.placeDeco(\r\n      this.activeDeco.node,\r\n      this.activeDeco.decoPoint,\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectPoint,\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize,\r\n      this.activeDeco.anchorType\r\n    );\r\n\r\n    // reset deco & file master\r\n    const decoMaster = this.decoMaster.getComponent(\"DecoMaster\") as DecoMaster;\r\n    decoMaster.resetDecoObject();\r\n    const fileMaster = this.fileMaster.getComponent(\"FileMaster\") as FileMaster;\r\n    fileMaster.updateFileMaster();\r\n    decoMaster.decoData = this.activeDeco;\r\n  }\r\n  getImgNode(imgResult) {\r\n    // set sprite frame\r\n    const imgAsset = new ImageAsset(imgResult);\r\n    const spriteFrame = new SpriteFrame();\r\n    const tex = new Texture2D();\r\n    tex.image = imgAsset;\r\n    spriteFrame.texture = tex;\r\n\r\n    // set node\r\n    const node = instantiate(this.assetManager.prefabDic[\"ImageNode\"]);\r\n    node.getComponent(Sprite).spriteFrame = spriteFrame;\r\n    // node.getComponent(UITransform).setContentSize(new Size(180, 180));\r\n    return node;\r\n  }\r\n\r\n  initDefaultDeco(decoObject: FileObject): Deco {\r\n    return {\r\n      decoId: uuidv4(),\r\n      selectedDeco: 0,\r\n      decoType: \"00\" as DecoType,\r\n      placeType: \"00\" as PlaceType,\r\n      decoPoint: new Vec3(0, 0, 0),\r\n      anchorType: \"00\" as AnchorType,\r\n      opacity: 1.0,\r\n      stackable: false,\r\n      stackSize: new Vec3(1, 1, 1),\r\n      defaultObjectId: decoObject.id,\r\n      objectArray: [],\r\n      zOrder: 0,\r\n      node: null,\r\n      label: \"\",\r\n    };\r\n  }\r\n\r\n  eraseDeco() {\r\n    if (this.activeDeco) {\r\n      if (this.activeDeco.node) {\r\n        this.activeDeco.node.removeFromParent();\r\n      }\r\n      const decoId = this.activeDeco.decoId;\r\n      delete this.decoDic[decoId];\r\n      this.activeDeco = null;\r\n    }\r\n    const decoMaster = this.decoMaster.getComponent(\"DecoMaster\") as DecoMaster;\r\n    decoMaster.resetDecoObject();\r\n    const fileMaster = this.fileMaster.getComponent(\"FileMaster\") as FileMaster;\r\n    fileMaster.updateFileMaster();\r\n  }\r\n\r\n  setDecoData(kind, obj) {\r\n    // console.log(kind, obj);\r\n    this.activeDeco[kind] = obj.tag;\r\n    if (kind == \"opacity\") {\r\n      this.activeDeco.node.getComponent(UIOpacityComponent).opacity =\r\n        obj.tag * 255;\r\n      return;\r\n    }\r\n    // console.log(kind, obj);\r\n    if (kind == \"decoType\" || kind == \"placeType\") {\r\n      this.updateDecoPoint();\r\n    }\r\n\r\n    if (\r\n      kind == \"decoType\" ||\r\n      kind == \"placeType\" ||\r\n      kind == \"decoPoint\" ||\r\n      kind == \"anchorType\"\r\n    ) {\r\n      this.placeDeco(\r\n        this.activeDeco.node,\r\n        this.activeDeco.decoPoint,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectPoint,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize,\r\n        this.activeDeco.anchorType\r\n      );\r\n    }\r\n  }\r\n  setObjectData(kind, obj) {\r\n    // console.log(kind, obj);\r\n    this.activeDeco.objectArray[this.activeDeco.selectedDeco][kind] = obj.tag;\r\n    if (kind == \"objectSize\" || kind == \"objectPoint\") {\r\n      this.placeDeco(\r\n        this.activeDeco.node,\r\n        this.activeDeco.decoPoint,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectPoint,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize,\r\n        this.activeDeco.anchorType\r\n      );\r\n    }\r\n  }\r\n  updateDecoPoint() {\r\n    // console.log(kind, obj);\r\n    switch (this.activeDeco.decoType + this.activeDeco.placeType) {\r\n      case \"0101\":\r\n        this.activeDeco.decoPoint = new Vec3(0, 0, 0);\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(18, 18, 0);\r\n        this.activeDeco.stackable = true;\r\n        this.activeDeco.stackSize = new Vec3(18, 18, 0);\r\n        this.activeDeco.anchorType = \"01\";\r\n        break;\r\n      case \"0202\":\r\n        this.activeDeco.decoPoint = new Vec3(0, 0, 0);\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(0, 18, 18);\r\n        this.activeDeco.stackable = true;\r\n        this.activeDeco.stackSize = new Vec3(0, 18, 18);\r\n        this.activeDeco.anchorType = \"02\";\r\n        break;\r\n      case \"0203\":\r\n        this.activeDeco.decoPoint = new Vec3(0, 17, 0);\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(18, 0, 18);\r\n        this.activeDeco.stackable = true;\r\n        this.activeDeco.stackSize = new Vec3(18, 0, 18);\r\n        this.activeDeco.anchorType = \"03\";\r\n        break;\r\n      default:\r\n        this.activeDeco.anchorType = \"00\";\r\n        if (this.activeDeco.placeType == \"00\") {\r\n          this.activeDeco.decoPoint = new Vec3(8.5, 8.5, 8.5);\r\n        }\r\n    }\r\n  }\r\n  getAnchorPoint(anchorType) {\r\n    if (anchorType == \"00\") {\r\n      return new Vec3(0.5, 0.5, 0.5);\r\n    } else if (anchorType == \"01\") {\r\n      return new Vec3(0.5, 0.5, 0.0);\r\n    } else if (anchorType == \"02\") {\r\n      return new Vec3(0, 0.5, 0.5);\r\n    } else if (anchorType == \"03\") {\r\n      return new Vec3(0.5, 1, 0.5);\r\n    }\r\n  }\r\n  updateDecoPlace() {\r\n    const point = this.activeDeco.decoPoint;\r\n    const objectPoint =\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectPoint;\r\n    const size =\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize;\r\n    const anchorType = this.activeDeco.anchorType;\r\n    const anchor = this.getAnchorPoint(anchorType);\r\n    const decoPoint = new Vec3(\r\n      point.x + objectPoint.x + Math.max(1, size.x) / 2 + (anchor.x - 0.5),\r\n      point.y + objectPoint.y + Math.max(1, size.y) / 2 + (anchor.y - 0.5),\r\n      point.z + objectPoint.z + Math.max(1, size.z) / 2 + (anchor.z - 0.5)\r\n    );\r\n    // console.log(decoPoint);\r\n    const roomScript = this.roomNode.getComponent(\r\n      \"RoomTemplate\"\r\n    ) as RoomTemplate;\r\n    this.activeDeco.node.setPosition(\r\n      roomScript.getBlockPosition(decoPoint.x, decoPoint.y, decoPoint.z)\r\n    );\r\n  }\r\n  placeDeco(node, point, objectPoint, size, anchorType) {\r\n    const anchor = this.getAnchorPoint(anchorType);\r\n    const decoPoint = new Vec3(\r\n      point.x + objectPoint.x + Math.max(1, size.x) / 2 + (anchor.x - 0.5),\r\n      point.y + objectPoint.y + Math.max(1, size.y) / 2 + (anchor.y - 0.5),\r\n      point.z + objectPoint.z + Math.max(1, size.z) / 2 + (anchor.z - 0.5)\r\n    );\r\n    // console.log(decoPoint);\r\n    const roomScript = this.roomNode.getComponent(\r\n      \"RoomTemplate\"\r\n    ) as RoomTemplate;\r\n    node.setPosition(\r\n      roomScript.getBlockPosition(decoPoint.x, decoPoint.y, decoPoint.z)\r\n    );\r\n    this.showDecoBlock(point, size);\r\n  }\r\n  showDecoBlock(point, size) {\r\n    const roomScript = this.roomNode.getComponent(\r\n      \"RoomTemplate\"\r\n    ) as RoomTemplate;\r\n    roomScript.showDecoBlock(point, size);\r\n  }\r\n  checkDecoData() {\r\n    console.log(this.activeDeco);\r\n  }\r\n\r\n  //////////////\r\n  onFileSelected(fileData) {\r\n    // reset deco & file master\r\n    const decoMaster = this.decoMaster.getComponent(\"DecoMaster\") as DecoMaster;\r\n    decoMaster.resetDecoObject();\r\n    const fileMaster = this.fileMaster.getComponent(\"FileMaster\") as FileMaster;\r\n    fileMaster.updateFileMaster();\r\n\r\n    // set decodata\r\n    this.activeDeco = fileData;\r\n    decoMaster.decoData = this.activeDeco;\r\n    this.showDecoBlock(\r\n      this.activeDeco.decoPoint,\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize\r\n    );\r\n  }\r\n  onDecoSelected(decoData: Deco) {\r\n    this.activeDeco = decoData;\r\n    const decoMaster = this.decoMaster.getComponent(\"DecoMaster\") as DecoMaster;\r\n    decoMaster.resetDecoObject();\r\n    decoMaster.decoData = this.activeDeco;\r\n    this.showDecoBlock(\r\n      this.activeDeco.decoPoint,\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize\r\n    );\r\n    this.selectedDeco = decoData.node;\r\n  }\r\n\r\n  onTouchMove(event) {\r\n    if (this.selectedDeco) {\r\n      const location = event.touch.getUILocation();\r\n      const placeType = this.activeDeco.placeType;\r\n      const roomScript = this.roomNode.getComponent(\r\n        \"RoomTemplate\"\r\n      ) as RoomTemplate;\r\n      const zeroPos = roomScript.getBlockPosition(0, 0, 0);\r\n      const sizePos = roomScript.getBlockPosition(\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize.x,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize.y,\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize.z\r\n      );\r\n      const targetList = roomScript.getBlockTarget(placeType);\r\n      let targetBlock = null;\r\n      let baseDis = 150;\r\n      for (var i in targetList) {\r\n        const block = targetList[i] as Node;\r\n        const distance = Math.sqrt(\r\n          Math.pow(\r\n            block.getWorldPosition().x -\r\n              (location.x - (sizePos.x - zeroPos.x) / 2),\r\n            2\r\n          ) +\r\n            Math.pow(\r\n              block.getWorldPosition().y -\r\n                (location.y - (sizePos.y - zeroPos.y) / 2),\r\n              2\r\n            )\r\n        );\r\n        if (distance < baseDis) {\r\n          baseDis = distance;\r\n          targetBlock = block;\r\n        }\r\n      }\r\n      if (targetBlock) {\r\n        const blockScript = targetBlock.getComponent(\"RoomBlock\") as RoomBlock;\r\n        this.activeDeco.decoPoint = blockScript.blockPosition;\r\n        this.updateDecoPlace();\r\n      }\r\n      // this.selectedDeco.setWorldPosition(new Vec3(location.x, location.y, 1));\r\n    }\r\n  }\r\n  onTouchEnd(event) {\r\n    // console.log(\"touc end\", event);\r\n    if (!event.simulate && this.selectedDeco) {\r\n      this.selectedDeco = null;\r\n    }\r\n  }\r\n  //////////////\r\n  setSelectedDeco(idx) {\r\n    if (this.activeDeco) {\r\n      this.activeDeco.selectedDeco = idx;\r\n      // console.log(this.activeDeco);\r\n      if (this.activeDeco.objectArray[idx].spriteFrame) {\r\n        this.activeDeco.node.getComponent(Sprite).spriteFrame =\r\n          this.activeDeco.objectArray[idx].spriteFrame;\r\n        this.updateDecoPlace();\r\n      } else {\r\n        if (this.activeDeco.node) {\r\n          this.activeDeco.node.getComponent(Sprite).spriteFrame =\r\n            this.assetManager.assetDic[\"Deco/default_sprite\"];\r\n        }\r\n      }\r\n    }\r\n  }\r\n  replaceDeco(kind, point, obj?) {\r\n    if (this.activeDeco) {\r\n      const imgPos = this.decoMaster\r\n        .getComponent(DecoMaster)\r\n        .imgNode.getWorldPosition();\r\n      const imgDistance = Math.sqrt(\r\n        Math.pow(imgPos.x - point.x, 2) + Math.pow(imgPos.y - point.y, 2)\r\n      );\r\n      const shadowPos = this.decoMaster\r\n        .getComponent(DecoMaster)\r\n        .shadowNode.getWorldPosition();\r\n      const shadowDistance = Math.sqrt(\r\n        Math.pow(shadowPos.x - point.x, 2) + Math.pow(shadowPos.y - point.y, 2)\r\n      );\r\n      if (kind == \"touchEnd\") {\r\n        if (imgDistance <= 150) {\r\n          this.replaceObjImage(0, obj);\r\n          this.decoMaster.getComponent(DecoMaster).replaceImg(0, obj);\r\n        } else if (shadowDistance <= 150) {\r\n          this.replaceObjImage(1, obj);\r\n          this.decoMaster.getComponent(DecoMaster).replaceImg(1, obj);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  replaceObjImage(kind, imgObject) {\r\n    const imgAsset = new ImageAsset(imgObject.img);\r\n    const spriteFrame = new SpriteFrame();\r\n    const tex = new Texture2D();\r\n    tex.image = imgAsset;\r\n    spriteFrame.texture = tex;\r\n    if (\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectId == \"\"\r\n    ) {\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectId =\r\n        uuidv4();\r\n    }\r\n\r\n    if (kind == 1) {\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].shadowFile =\r\n        imgObject.file;\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].shadowFrame =\r\n        spriteFrame;\r\n      return;\r\n    }\r\n\r\n    if (kind == 0) {\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].imgFile =\r\n        imgObject.file;\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].spriteFrame =\r\n        spriteFrame;\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].imgURL = \"\";\r\n      this.activeDeco.node.getComponent(Sprite).spriteFrame = spriteFrame;\r\n    }\r\n\r\n    if (this.activeDeco.selectedDeco == 0) {\r\n      const tag = this.activeDeco.placeType;\r\n      if (tag == \"01\") {\r\n        const xSize = Math.min(18, Math.ceil(spriteFrame.width / (140 / 3)));\r\n        const ySize = Math.min(18, Math.ceil(spriteFrame.height / (40 / 3)));\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(xSize, ySize, 0);\r\n      } else if (tag == \"02\") {\r\n        const ySize = Math.min(18, Math.ceil(spriteFrame.width / (70 / 3)));\r\n        const zSize = Math.min(18, Math.ceil(spriteFrame.height / (85 / 3)));\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(0, ySize, zSize);\r\n      } else if (tag == \"03\") {\r\n        const xSize = Math.min(18, Math.ceil(spriteFrame.width / (70 / 3)));\r\n        const zSize = Math.min(18, Math.ceil(spriteFrame.height / (85 / 3)));\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n          new Vec3(xSize, 0, zSize);\r\n      }\r\n    } else {\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectPoint =\r\n        this.activeDeco.objectArray[0].objectPoint;\r\n      this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectSize =\r\n        this.activeDeco.objectArray[0].objectSize;\r\n    }\r\n    this.updateDecoPlace();\r\n  }\r\n  //////////////\r\n  async sendImage(fileName, img) {\r\n    // (1) send images\r\n    const r = await fetch(\r\n      \"https://us-central1-slot-deco.cloudfunctions.net/uploadImage\",\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Access-Control-Allow-Origin\": \"*\",\r\n        },\r\n        body: JSON.stringify({\r\n          image: String(img),\r\n          fileName: fileName,\r\n        }),\r\n      }\r\n    );\r\n    return JSON.parse(await r.text());\r\n    // console.log(result);\r\n  }\r\n\r\n  async sendData(collection, doc, data) {\r\n    // (1) save datas\r\n    const r = await fetch(\r\n      \"https://us-central1-slot-deco.cloudfunctions.net/uploadData\",\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Access-Control-Allow-Origin\": \"*\",\r\n        },\r\n        body: JSON.stringify({\r\n          collection: String(collection),\r\n          doc: String(doc),\r\n          data: JSON.stringify(data),\r\n        }),\r\n      }\r\n    );\r\n    return JSON.parse(await r.text());\r\n  }\r\n\r\n  async loadData(roomId) {\r\n    // (1) save datas\r\n    const r = await fetch(\r\n      \"https://us-central1-slot-deco.cloudfunctions.net/getRoomData\",\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Access-Control-Allow-Origin\": \"*\",\r\n        },\r\n        body: JSON.stringify({\r\n          roomId: roomId,\r\n        }),\r\n      }\r\n    );\r\n    return JSON.parse(await r.text());\r\n  }\r\n\r\n  roomDecoSelected(node, idx) {\r\n    this.selectedIdx = Number(idx);\r\n    const decoKeys = Object.keys(this.decoDic);\r\n    for (var i in decoKeys) {\r\n      const key = decoKeys[i];\r\n      const decoObject = this.decoDic[key];\r\n      decoObject.selectedDeco = this.selectedIdx;\r\n\r\n      if (decoObject.objectArray[this.selectedIdx].spriteFrame) {\r\n        decoObject.node.getComponent(Sprite).spriteFrame =\r\n          decoObject.objectArray[this.selectedIdx].spriteFrame;\r\n      } else {\r\n        decoObject.node.getComponent(Sprite).spriteFrame =\r\n          this.assetManager.assetDic[\"Deco/default_sprite\"];\r\n      }\r\n\r\n      this.placeDeco(\r\n        decoObject.node,\r\n        decoObject.decoPoint,\r\n        decoObject.objectArray[decoObject.selectedDeco].objectPoint,\r\n        decoObject.objectArray[decoObject.selectedDeco].objectSize,\r\n        decoObject.anchorType\r\n      );\r\n    }\r\n  }\r\n  //////////\r\n  resetRoomDeco() {\r\n    this.roomId = uuidv4();\r\n    const modalLayer = this.setModalColor();\r\n    const alertPrefab = instantiate(this.assetManager.prefabDic[\"DecoAlert\"]);\r\n    modalLayer.addChild(alertPrefab);\r\n    const alertScript = alertPrefab.getComponent(DecoAlert);\r\n    alertScript.setTitleLabel(\"방 초기화\");\r\n    alertScript.setMainLabel(\"모든 방의 데코레이션을 초기화하시겠습니까?\");\r\n    var self = this;\r\n    alertScript.yesEvent = () => {\r\n      const decoKeys = Object.keys(self.decoDic);\r\n      for (var i in decoKeys) {\r\n        const key = decoKeys[i];\r\n        if (self.decoDic[key].node) {\r\n          this.decoDic[key].node.removeFromParent();\r\n        }\r\n        delete self.decoDic[key];\r\n      }\r\n      this.eraseDeco();\r\n      const decoMaster = this.decoMaster.getComponent(\r\n        \"DecoMaster\"\r\n      ) as DecoMaster;\r\n      decoMaster.updateObjectImg();\r\n      const fileMaster = this.fileMaster.getComponent(\r\n        \"FileMaster\"\r\n      ) as FileMaster;\r\n      fileMaster.removeObjDic();\r\n      alertScript.removeAlert();\r\n    };\r\n  }\r\n  async loadRoomDeco() {\r\n    const modalLayer = this.setModalColor();\r\n    const alertPrefab = instantiate(this.assetManager.prefabDic[\"DecoAlert\"]);\r\n    modalLayer.addChild(alertPrefab);\r\n    const alertScript = alertPrefab.getComponent(DecoAlert);\r\n    alertScript.setTitleLabel(\"데코레이션 불러오기\");\r\n    alertScript.editNodeActive(true);\r\n    var self = this;\r\n    alertScript.yesEvent = async () => {\r\n      const editBox = alertScript.editLabelNode.getComponent(EditBox);\r\n      const roomId = editBox.string;\r\n      if (roomId.length != 36) {\r\n        console.log(\"룸 정보 오류\");\r\n        return;\r\n      }\r\n      alertScript.buttonActive(false);\r\n      const roomDataResult = await self.loadData(roomId);\r\n      roomDataResult.roomData = JSON.parse(roomDataResult.roomData);\r\n      roomDataResult.decoArray = JSON.parse(roomDataResult.decoArray);\r\n      roomDataResult.objectArray = JSON.parse(roomDataResult.objectArray);\r\n      // set updated data\r\n      const objectDic = self.updateRoomDeco(roomDataResult);\r\n      self.updateImages(objectDic);\r\n      alertScript.removeAlert();\r\n    };\r\n  }\r\n  updateRoomDeco(roomDataResult) {\r\n    this.roomId = roomDataResult.roomData.roomId;\r\n    this.activeDeco = null;\r\n    this.decoDic = {};\r\n    const objectDic = {};\r\n    for (var i in roomDataResult.objectArray) {\r\n      const objectData = roomDataResult.objectArray[i];\r\n      const objectId = objectData.objectId;\r\n      objectData.spriteFrame = \"\";\r\n      objectData.imgFile = \"\";\r\n      objectData.shadowFrame = \"\";\r\n      objectData.shadowFile = \"\";\r\n      objectData.objectPlace = new Vec3(\r\n        objectData.objectPlace.x,\r\n        objectData.objectPlace.y,\r\n        objectData.objectPlace.z\r\n      );\r\n      objectData.objectPoint = new Vec3(\r\n        objectData.objectPoint.x,\r\n        objectData.objectPoint.y,\r\n        objectData.objectPoint.z\r\n      );\r\n      objectData.objectSize = new Vec3(\r\n        objectData.objectSize.x,\r\n        objectData.objectSize.y,\r\n        objectData.objectSize.z\r\n      );\r\n      objectDic[objectId] = objectData;\r\n    }\r\n    for (var i in roomDataResult.decoArray) {\r\n      const decoData = roomDataResult.decoArray[i] as Deco;\r\n      delete decoData[\"updatedTime\"];\r\n      const decoId = decoData.decoId;\r\n      decoData.label = \"오브젝트\" + String(i);\r\n      decoData.selectedDeco = 0;\r\n      decoData.decoPoint = new Vec3(\r\n        decoData.decoPoint.x,\r\n        decoData.decoPoint.y,\r\n        decoData.decoPoint.z\r\n      );\r\n      decoData.stackSize = new Vec3(\r\n        decoData.stackSize.x,\r\n        decoData.stackSize.y,\r\n        decoData.stackSize.z\r\n      );\r\n      for (var j in decoData.objectArray) {\r\n        const objectId = decoData.objectArray[j];\r\n        decoData.objectArray[j] = objectDic[objectId as any];\r\n      }\r\n      while (decoData.objectArray.length < 3) {\r\n        decoData.objectArray.push({\r\n          objectId: \"\",\r\n          objectIdx: Number(j) + 1,\r\n          decoId: decoData.decoId,\r\n          objectPoint: new Vec3(0, 0, 0),\r\n          objectSize: new Vec3(1, 1, 1),\r\n          objectPlace: new Vec3(0, 0, 0),\r\n          imgURL: \"\",\r\n          spriteFrame: \"\",\r\n          imgFile: \"\",\r\n          shadowFrame: \"\",\r\n          shadowFile: \"\",\r\n          buyType: \"00\",\r\n          cashPrice: 0,\r\n        });\r\n      }\r\n      const imgNode = instantiate(this.assetManager.prefabDic[\"ImageNode\"]);\r\n      const imgSprite = imgNode.getComponent(Sprite);\r\n      imgSprite.sizeMode = Sprite.SizeMode.RAW;\r\n      imgSprite.trim = true;\r\n      let nodeOrder = Object.keys(this.decoDic).length;\r\n      (this.roomNode.getComponent(\"RoomTemplate\") as RoomTemplate).addDecoNode(\r\n        imgNode,\r\n        nodeOrder,\r\n        decoData.placeType == \"00\"\r\n      );\r\n      decoData.node = imgNode;\r\n      // set deco position\r\n      // console.log(decoData, decoData.selectedDeco);\r\n      this.placeDeco(\r\n        imgNode,\r\n        decoData.decoPoint,\r\n        decoData.objectArray[decoData.selectedDeco].objectPoint,\r\n        decoData.objectArray[decoData.selectedDeco].objectSize,\r\n        decoData.anchorType\r\n      );\r\n\r\n      this.decoDic[decoId] = decoData;\r\n      if (!this.activeDeco) {\r\n        this.activeDeco = this.decoDic[decoId] as Deco;\r\n      }\r\n    }\r\n    // console.log(this.decoDic);\r\n    const decoMaster = this.decoMaster.getComponent(\"DecoMaster\") as DecoMaster;\r\n    decoMaster.resetDecoObject();\r\n    decoMaster.decoData = this.activeDeco;\r\n    const fileMaster = this.fileMaster.getComponent(\"FileMaster\") as FileMaster;\r\n    fileMaster.decoDic = this.decoDic;\r\n    fileMaster.updateFileMaster();\r\n    decoMaster.decoData = this.activeDeco;\r\n\r\n    return objectDic;\r\n  }\r\n  async updateImages(objectDic) {\r\n    const keys = Object.keys(objectDic);\r\n    for (var i in keys) {\r\n      const key = keys[i];\r\n      const obj = objectDic[key] as DecoObj;\r\n      const fileResult = (await this.assetManager.loadImgFromURL(\r\n        obj.imgURL\r\n      )) as any;\r\n      obj.spriteFrame = fileResult.spriteFrame;\r\n      obj.imgFile = fileResult.imgFile;\r\n\r\n      // (1) update deco master\r\n      if (\r\n        this.activeDeco.objectArray[this.activeDeco.selectedDeco].objectId ==\r\n        obj.objectId\r\n      ) {\r\n        const decoMaster = this.decoMaster.getComponent(\r\n          \"DecoMaster\"\r\n        ) as DecoMaster;\r\n        decoMaster.updateObjectImg();\r\n      }\r\n      // (2) update deco\r\n      const decoData = this.decoDic[obj.decoId];\r\n      if (\r\n        decoData.objectArray[decoData.selectedDeco].objectId == obj.objectId\r\n      ) {\r\n        decoData.node.getComponent(Sprite).spriteFrame = obj.spriteFrame;\r\n      }\r\n      // (3) add to filemaster\r\n      const fileMaster = this.fileMaster.getComponent(\r\n        \"FileMaster\"\r\n      ) as FileMaster;\r\n      fileMaster.addImgObj(fileResult, obj.objectIdx);\r\n      // filemaster, roomtemplate, decomaster;\r\n    }\r\n  }\r\n  async saveRoomDeco() {\r\n    // console.log(this.decoDic);\r\n    const modalLayer = this.setModalColor();\r\n    const alertPrefab = instantiate(this.assetManager.prefabDic[\"DecoAlert\"]);\r\n    modalLayer.addChild(alertPrefab);\r\n    const alertScript = alertPrefab.getComponent(DecoAlert);\r\n    alertScript.setTitleLabel(\"데코레이션 저장\");\r\n    alertScript.setMainLabel(\"방의 데코레이션을 서버에 정하시겠습니까?\");\r\n    var self = this;\r\n    alertScript.yesEvent = async () => {\r\n      alertScript.progress = true;\r\n      alertScript.setMainLabel(\"꾸미기 정보 업로드를 시작합니다.\");\r\n      alertScript.buttonActive(false);\r\n      const objList = [];\r\n      const decoList = [];\r\n      const roomDic = {\r\n        roomId: self.roomId,\r\n        docoArray: [],\r\n      };\r\n      ////////////////////\r\n      const decoKeys = Object.keys(self.decoDic);\r\n      for (var i in decoKeys) {\r\n        const decoKey = decoKeys[i];\r\n        const decoObjList = [];\r\n        for (var j in self.decoDic[decoKey].objectArray) {\r\n          const obj = self.decoDic[decoKey].objectArray[j];\r\n          if (obj.objectId == \"\") {\r\n            continue;\r\n          }\r\n          const copyObj = Object.assign({}, obj);\r\n          delete copyObj[\"spriteFrame\"];\r\n          delete copyObj[\"imgFile\"];\r\n          delete copyObj[\"shadowFrame\"];\r\n          delete copyObj[\"shadowFile\"];\r\n          copyObj.objectPlace = {\r\n            x: obj.objectPlace.x,\r\n            y: obj.objectPlace.y,\r\n            z: obj.objectPlace.z,\r\n          };\r\n          copyObj.objectPoint = {\r\n            x: obj.objectPoint.x,\r\n            y: obj.objectPoint.y,\r\n            z: obj.objectPoint.z,\r\n          };\r\n          copyObj.objectSize = {\r\n            x: obj.objectSize.x,\r\n            y: obj.objectSize.y,\r\n            z: obj.objectSize.z,\r\n          };\r\n          if (obj.imgURL == \"\") {\r\n            const result = await self.sendImage(obj.objectId, obj.imgFile);\r\n            if (result.result == \"success\") {\r\n              copyObj.imgURL = result.url;\r\n            } else {\r\n              console.log(\"img upload error\", result);\r\n              break;\r\n            }\r\n          }\r\n          objList.push(copyObj);\r\n          decoObjList.push(obj.objectId);\r\n          // send obj data to server\r\n          const objectResult = await self.sendData(\r\n            \"object_datas\",\r\n            copyObj.objectId,\r\n            copyObj\r\n          );\r\n          if (objectResult.data != \"success\") {\r\n            console.log(\"오브젝트 정보 업로드 실패 : \", copyObj.objectId);\r\n          }\r\n          // console.log(objectResult);\r\n        }\r\n        const copyDeco = Object.assign({}, self.decoDic[decoKey]) as Deco;\r\n        delete copyDeco[\"node\"];\r\n        delete copyDeco[\"label\"];\r\n        delete copyDeco[\"objectArray\"];\r\n        delete copyDeco[\"selectedDeco\"];\r\n\r\n        copyDeco.decoPoint = {\r\n          x: copyDeco.decoPoint.x,\r\n          y: copyDeco.decoPoint.y,\r\n          z: copyDeco.decoPoint.z,\r\n        };\r\n        copyDeco.stackSize = {\r\n          x: copyDeco.stackSize.x,\r\n          y: copyDeco.stackSize.y,\r\n          z: copyDeco.stackSize.z,\r\n        };\r\n        copyDeco.objectArray = decoObjList;\r\n        decoList.push(copyDeco);\r\n        roomDic.docoArray.push(self.decoDic[decoKey].decoId);\r\n        // send deco data to server\r\n        const decoResult = await self.sendData(\r\n          \"deco_datas\",\r\n          copyDeco.decoId,\r\n          copyDeco\r\n        );\r\n        if (decoResult.data != \"success\") {\r\n          console.log(\"꾸미기 정보 업로드 실패 : \", copyDeco.decoId);\r\n        }\r\n        // console.log(decoResult);\r\n      }\r\n      // send room data to server\r\n      const roomResult = await self.sendData(\r\n        \"room_datas\",\r\n        roomDic.roomId,\r\n        roomDic\r\n      );\r\n      if (roomResult.data != \"success\") {\r\n        console.log(\"방 정보 업로드 실패 : \", roomDic.roomId);\r\n      }\r\n      alertScript.setMainLabel(\r\n        \"꾸미기 정보 업로드가 완료되었습니다. \" + roomDic.roomId\r\n      );\r\n      console.log(roomDic.roomId);\r\n      alertScript.noButtonActive(true);\r\n    };\r\n  }\r\n}\r\n"]}